---
title: "How do experiences of violence affect women's preferences for facial masculinity according to resource availability? An exploratory study using eye-tracking"
subtitle: Code and analyses
author:
  - name: Milena Vásquez-Amézquita \orcidlink{0000-0001-7317-8430}
    correspondence: true
    institute: [costa, ueb]
    email: mvasquezam@unbosque.edu.co
  - name: Wendy Medina-Sarmiento
    correspondence: false
    institute: ueb
  - name: Valentina Cepeda
    correspondence: false
    institute: ueb
  - name: Andrés Castellanos-Chacón \orcidlink{0000-0003-1684-9319}
    correspondence: false
    institute: evoco
  - name: Marina Begoña Martínez-González \orcidlink{0000-0002-5840-6383}
    correspondence: false
    institute: costa
  - name: Meredith L. Chivers \orcidlink{0000-0002-5495-9263}
    correspondence: false
    institute: queen
  - name: Juan David Leongómez \orcidlink{0000-0002-0092-6298}
    correspondence: false
    institute: evoco
institute:
  - ueb: "Faculty of Psychology, Universidad El Bosque, Bogota, Colombia."
  - evoco: "EvoCo: Human Behaviour and Evolution Lab, Faculty of Psychology, Universidad El Bosque, Bogota, Colombia"
  - costa: "Faculty of Psychology, Universidad de la Costa, Barranquilla, Colombia."
  - queen: "Department of Psychology, Queen’s University, Kingston, Ontario, Canada."
date: "`r Sys.setlocale('LC_TIME','en_GB.UTF-8');format(Sys.Date(),'%d %B, %Y')`"
output:
  bookdown::pdf_document2:
    citation_package: biblatex
    highlight: zenburn
    number_sections: yes
    keep_tex: false
    toc: no
    pandoc_args:
      - '--lua-filter=lua/scholarly-metadata.lua'
      - '--lua-filter=lua/author-info-blocks.lua'
classoption: 
      - bookmarksnumbered
editor_options:
  chunk_output_type: console
geometry: margin=2cm
header-includes: 
  \usepackage{caption} 
  \usepackage{float} 
  \floatplacement{figure}{H} 
  \usepackage[utf8]{inputenc} 
  \usepackage{fancyhdr}
  \pagestyle{fancy} 
  \usepackage{hanging}
  \lhead{Vásquez-Amézquita et al.} 
  \rhead{\textit{Exploring violence, resource access, and facial masculinity preferences}} 
  \renewcommand{\abstractname}{Description} 
  \usepackage[american]{babel}
  \usepackage{csquotes}
  \usepackage[style=apa,backend=biber]{biblatex}
  \DeclareLanguageMapping{american}{american-apa}
  \usepackage{hanging}
  \usepackage{amsthm,amssymb,amsfonts}
  \usepackage{tikz,lipsum,lmodern}
  \usepackage{multicol}
  \usepackage{orcidlink}
  \newcommand{\opensupplement}{\setcounter{table}{0}
    \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0}
    \renewcommand{\thefigure}{S\arabic{figure}}}
  \newcommand{\closesupplement}{\setcounter{table}{0}
    \renewcommand{\thetable}{\arabic{table}} \setcounter{figure}{0}
    \renewcommand{\thefigure}{\arabic{figure}}}
  \usepackage{multirow,booktabs,setspace}
  \DeclareCaptionLabelSeparator{point}{. }
  \captionsetup[table]{labelfont=bf,
    textfont=it,
    format=plain,
    labelsep=point,
    skip=5pt}
  \captionsetup[figure]{labelfont=bf,
    format=plain,
    justification=justified,
    singlelinecheck=false,
    labelsep=point,
    skip=5pt}
always_allow_html: yes
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
bibliography: bib/Bibliography.bib
urlcolor: blue
linkcolor: gray
citecolor: gray
link-citations: true
---

------------------------------------------------------------------------

```{=tex}
\begin{center}
\textbf{Description}
\end{center}

\par
\begingroup
\leftskip3em
\rightskip\leftskip
```
This document contains all code, and step by step explanations for all analyses, figures and tables (including supplementary figures and tables) for:

```{=latex}
\begin{hangparas}{.25in}{1}
Vásquez-Amézquita, M., Castellanos-Chacón, A., Medina-Sarmiento, W., Cepeda, V., Martínez-González, M. B., Chivers, M. L., \& Leongómez, J. D.,  (in prep). \textit{How do experiences of violence affect women's preferences for facial masculinity according to resource availability? An exploratory study using eye-tracking.}
\end{hangparas}
```

Data available from the Open Science Framework (OSF): <https://doi.org/10.17605/OSF.IO/P2WSC>. All analyses were planned by Milena Vásquez-Amézquita and Juan David Leongómez. This document and its underlying code were created in `R Markdown` by Juan David Leongómez using \LaTeX.

------------------------------------------------------------------------

```{=latex}
\par
\endgroup

{\hypersetup{hidelinks}
\setcounter{tocdepth}{6}
\tableofcontents
}
\opensupplement
```

```{r results = "hold", setup, include = FALSE}
library(knitr)
opts_chunk$set(
  fig.width = 12, fig.height = 8, fig.pos = "H", 
  message = FALSE, warnings = FALSE
)
options(knitr.kable.NA = " ")
opts_knit$set(eval.after = "fig.cap")
```

----------------

# Preliminaries

## Load packages

This file was created using `knitr` [@knitrcit], mostly using `tidyverse` [@tidyversecit] syntax. As such, data wrangling was mainly done using packages such as `dplyr` [@dplyrcit], and most figures were created or modified using `ggplot2` [@ggplotcit]. Tables were created using `knitr::kable` and `kableExtra` [@kableExtracit].

Linear mixed models were fitted using `lmerTest` [@lmertestcit], assumptions were performed using `performance` [@ludecke2021], contrasts and interactions were explored using `emmeans` [@emmeanscit].

Used packages also include `osfr` [@osfrcit] to download and open data files directly from the Open Science Framework ([OSF](https://osf.io/)), using the `osf_retrieve_file` and `osf_download` functions.

All packages used in this file can be directly installed from the Comprehensive R Archive Network ([CRAN](https://cran.r-project.org/)). For a complete list of packages used to create this file, and their versions, see section \@ref(session), at the end of the document.

```{r message = FALSE}
library(car)
library(MASS)
library(ggstats)
library(tidyverse)
library(ggpubr)
library(readxl)
library(lmerTest)
library(emmeans)
library(knitr)
library(kableExtra)
library(performance)
library(GGally)
library(scales)
library(factoextra)
library(FactoMineR)
library(gtools)
library(bbmle)
library(effectsize)
library(insight)
library(magick)
```

## Custom functions

### `pval.lev`and `small.lev`

This functions take small numbers and format them in \LaTeX. For *p* values, significant results are highlighted in bold.

```{r}
# Define a function 'pval.lev' to format p-values based on specific thresholds.
pval.lev <- function(pvals) {
  # If the p-value is less than 0.0001, return the string '\textbf{< 0.0001}'.
  ifelse(pvals < 0.0001,
         "\\textbf{< 0.0001}",
         # If the p-value is less than 0.001, return the string '\textbf{< 0.001}'.
         ifelse(pvals < 0.001,
                "\\textbf{< 0.001}",
                # If the p-value is less than 0.05, format it with bold text and round to 4
                # decimal places.
                ifelse(pvals < 0.05,
                       paste0("\\textbf{", round(pvals, 4), "}"),
                       # Otherwise, round the p-value to 2 decimal places.
                       round(pvals, 2)
                )
         )
  )
}


small.lev <- function(vals) {
  # If the p-value is less than 0.00001, return the string '\textbf{< 0.0001}'.
  ifelse(vals < 0.00001,
         "< 0.00001",
         # If the p-value is less than 0.0001, return the string '\textbf{< 0.0001}'.
         ifelse(vals < 0.0001,
                "< 0.0001",
                # If the p-value is less than 0.001, return the string '\textbf{< 0.001}'.
                ifelse(vals < 0.001,
                       "< 0.001",
                       # If the p-value is less than 0.05, format it with bold text and round to 4
                       # decimal places.
                       ifelse(vals < 0.05,
                              paste0("", round(vals, 4), ""),
                              # Otherwise, round the p-value to 2 decimal places.
                              round(vals, 2)
                       )
                )
         )
  )
}
```

### `corr.stars`

This function creates a correlation matrix, and displays significance (function `corr.stars` modified from <http://myowelt.blogspot.com/2008/04/beautiful-correlation-tables-in-r.html>).

```{r}
corr.stars <- function(x) {
  # Load the 'Hmisc' package, which is required for the 'rcorr' function.
  require(Hmisc)
  # Convert the input 'x' to a matrix in case it is not already.
  x <- as.matrix(x)
  # Compute the correlation matrix (R) and p-values (p) using the 'rcorr' function.
  R <- rcorr(x)$r # Correlation matrix
  p <- rcorr(x)$P # p-value matrix
  # Define significance levels for the stars notation.
  # *** for p < 0.001, ** for p < 0.01, * for p < 0.05, and † for p < 0.10.
  mystars <- ifelse(p < .001,
                    paste0("\\textbf{", round(R, 2), "***}"),
                    ifelse(p < .01,
                           paste0("\\textbf{", round(R, 2), "**}"),
                           ifelse(p < .05,
                                  paste0("\\textbf{", round(R, 2), "*}"),
                                  ifelse(p < .10,
                                         paste0(round(R, 2), "$^{\\dagger}$"),
                                         format(round(R, 2), nsmall = 2)
                                  )
                           )
                    )
  )
  # Build a new matrix 'Rnew' that contains the correlations and their significance stars.
  Rnew <- matrix(mystars,
                 ncol = ncol(x)
  ) # Ensure the new matrix has the same number of columns as 'x'
  # Add the correlation values without stars to the diagonal (self-correlations).
  diag(Rnew) <- paste(diag(R), " ",
                      sep = ""
  )
  # Set row names and column names of the matrix 'Rnew' to match those of the original matrix.
  rownames(Rnew) <- colnames(x)
  colnames(Rnew) <- paste(colnames(x), "", sep = "")
  # Remove the upper triangle and the diagonal of the matrix to avoid duplication.
  Rnew <- as.matrix(Rnew)
  Rnew[upper.tri(Rnew, diag = TRUE)] <- ""
  # Convert the matrix to a data frame for easier handling.
  Rnew <- as.data.frame(Rnew)
  # Remove the last column (empty column from the upper triangle) and return the result.
  Rnew <- cbind(Rnew[1:length(Rnew) - 1])
  # Return the final correlation matrix with significance stars.
  return(Rnew)
}
```

### `lmer.anova.tab`, `glmer.anova.tab` and `lm.anova.tab`

These functions take a model, and creates an ANOVA-type table of fixed effects, formatted in \LaTeX.

```{r}
# lmer.anova.tab for linear mixed-effects models
lmer.anova.tab <- function(model) {
  
  r2 <- r2_nakagawa(model)
  
  tab <- anova(model) |>
    rownames_to_column(var = "Effect") |> 
    mutate(Effect = str_replace_all(Effect, "_", " "),
           Effect = str_replace_all(Effect, ":", " × "),
           Effect = str_replace_all(Effect, "Freq partner physical", "Physical"),
           df = paste0(NumDF, ", ", round(DenDF, 2))) |> 
    rename("F" = "F value",
           "p" = "Pr(>F)") |>
    mutate(F = round(F, 2),
           p = pval.lev(p)) |> 
    select(Effect, F, df, p) |> 
    add_row(Effect = paste0("Conditional = ", round(r2$R2_conditional, 2))) |> 
    add_row(Effect = paste0("Marginal = ",signif(r2$R2_marginal, 2))) |> 
    rename("Fixed effect" = "Effect",
           "$F$" = "F",
           "$df$" = "df",
           "$p$" = "p")
  
  caption <- paste0("ANOVA-type table of fixed effects for the ", find_response(model), " model")
  
  n_rows <- dim(tab)[1]
  
  taa <- kable(tab,
               digits = 2,
               booktabs = TRUE,
               align = c("l", rep("c", 3)),
               linesep = "",
               caption = caption,
               escape = FALSE) |>
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    pack_rows("Nakagawa's $R^2$",
              start_row = n_rows-1, end_row = n_rows,
              hline_after = TRUE, hline_before = TRUE,
              escape = FALSE)
  return(list(tab = tab, kab = taa))
}

# glmer.anova.tab for generalized linear mixed-effects models
glmer.anova.tab <- function(model) {
  
  r2 <- r2_nakagawa(model)
  
  tab <- Anova(model, type = "II") |>
    rownames_to_column(var = "Effect") |> 
    mutate(Effect = str_replace_all(Effect, "_", " "),
           Effect = str_replace_all(Effect, ":", " × "),
           Effect = str_replace_all(Effect, "Freq partner physical", "Physical")) |> 
    filter(Effect != "(Intercept)") |> 
    rename("p" = "Pr(>Chisq)") |>
    mutate(Chisq = round(Chisq, 2),
           p = pval.lev(p)) |> 
    add_row(Effect = paste0("Conditional = ", round(r2$R2_conditional, 2))) |> 
    add_row(Effect = paste0("Marginal = ",signif(r2$R2_marginal, 2))) |> 
    rename("Fixed effect" = "Effect",
           "$\\chi^2$" = "Chisq",
           "$df$" = "Df",
           "$p$" = "p")
  
  caption <- paste0("ANOVA-type table of fixed effects for the ", find_response(model), " model")
  
  n_rows <- dim(tab)[1]
  
  taa <- kable(tab,
               digits = 2,
               booktabs = TRUE,
               align = c("l", rep("c", 3)),
               linesep = "",
               caption = caption,
               escape = FALSE) |>
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    pack_rows("Nakagawa's $R^2$",
              start_row = n_rows-1, end_row = n_rows,
              hline_after = TRUE, hline_before = TRUE,
              escape = FALSE)
  return(list(tab = tab, kab = taa))
}

# lm.anova.tab for linear models
lm.anova.tab <- function(model) {
  
  r2 <- r2(model)
  
  DenDF <- last(Anova(model, type = 3)$Df)
  
  omega <- data.frame(omega_squared(model)) |> 
    rename(Effect = Parameter)
  
  tab <- anova(model) |>
    rownames_to_column(var = "Effect") |> 
    filter(Effect != "(Intercept)") |> 
    mutate(Effect = str_replace_all(Effect, "_", " "),
           Effect = str_replace_all(Effect, ":", " × "),
           Effect = str_replace_all(Effect, "Freq partner physical", "Physical"),
           df = paste0(Df, ", ", round(DenDF, 2))) |> 
    filter(Effect != "Residuals") |>
    rename("F" = "F value",
           "p" = "Pr(>F)") |>
    mutate(F = round(F, 2),
           p = pval.lev(p)) |> 
    select(Effect, F, df, p) |> 
    mutate(omega = omega$Omega2_partial) |> 
    add_row(Effect = paste0("Unadjusted = ", signif(r2$R2, 2))) |> 
    add_row(Effect = paste0("Adjusted = ",signif(r2$R2_adjusted, 2))) |> 
    rename("Fixed effect" = "Effect",
           "$F$" = "F",
           "$df$" = "df",
           "$p$" = "p",
           "$\\omega^2_p$" = "omega")
  
  caption <- paste0("ANOVA-type table of fixed effects for the ", find_response(model), " model")
  
  n_rows <- dim(tab)[1]
  
  taa <- kable(tab,
               digits = 2,
               booktabs = TRUE,
               align = c("l", rep("c", 3)),
               linesep = "",
               caption = caption,
               escape = FALSE) |>
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    pack_rows("$R^2$",
              start_row = n_rows-1, end_row = n_rows,
              hline_after = TRUE, hline_before = TRUE,
              escape = FALSE)
  return(list(tab = tab, kab = taa))
}
```

### `main.eff.contr`

This function takes a model, and creates an table of estimated marginal means and contrast between responses to masculinized and feminized responses, formatted in \LaTeX.

```{r}
main.eff.contr <- function(model, emm_contr) {
  
  headers <- c(5, 4)
  names(headers) <- c(" ", 
                      paste0("Contrasts (",
                             first(data.frame(emm_contr$contrast)$contrast),
                             ")"))
  
  merge(data.frame(emm_contr$emmeans),
        data.frame(emm_contr$contrast) |> 
          mutate(p.value = pval.lev(p.value)) |> 
          add_row(),
        by = 0) |> 
    select(-c(Row.names, df.x, df.y, contrast)) |> 
    kable(digits = 2, 
          booktabs = TRUE, 
          align = c("l", rep("c", 8)),
          linesep = "", 
          caption = paste0("Estimated marginal and constrast between ",
                           str_replace_all(emm_contr$emmeans@roles$predictors[1], "_", " "), 
                           " levels for the ",
                           find_response(model), " model"),
          col.names = c(str_replace_all(emm_contr$emmeans@roles$predictors[1], "_", " "),
                        "EMM", 
                        "$SE$", 
                        "$2.5\\%CI$", 
                        "$97.5\\%CI$", 
                        "Difference", 
                        "$SE$", 
                        "$z$", 
                        "$p$"), 
          escape = FALSE) |> 
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    add_header_above(header = headers) |> 
    footnote(general = "EMM = estimated marginal mean. No degrees of freedom are reported, 
             as an asymptotic method was used. Because of this, \\\\textit{z} rather than 
             \\\\textit{t} scores are reported. Significant effects are in bold.",
             threeparttable = TRUE, 
             footnote_as_chunk = TRUE, 
             escape = FALSE)
}
```

### `inter.contr`

This function takes a model, and creates an table of estimated marginal means and contrast between responses to masculinized and feminized responses, formatted in \LaTeX.

```{r}
inter.contr <- function(model, emm_contr) {
  
  headers <- c(6, 4)
  names(headers) <- c(" ", 
                      paste0("Contrasts (",
                             first(data.frame(emm_contr$contrast)$contrast),
                             ")"))
  
  contr_levs <- paste0("Contrasts (",
                       first(data.frame(emm_contr$contrast)$contrast),
                       ")")
  
  merge(data.frame(emm_contr$emmeans),
        data.frame(emm_contr$contrast) |>
          mutate(p.value = pval.lev(p.value)) |> 
          add_row(.after = 1) |> add_row(),
        by = 0) |>
    rename_with(~ str_remove_all(., ".x")) |> 
    select(3,2,4,5,7,8,11,12,14,15) |> 
    kable(digits = 2, 
          booktabs = TRUE, 
          align = c(rep("l",2), rep("c",8)),
          linesep ="", 
          caption = paste0("Estimated marginal and constrast between ",
                           str_replace_all(emm_contr$emmeans@roles$predictors[1], "_", " "), 
                           " levels by ", 
                           emm_contr$emmeans@roles$predictors[2], 
                           " for the ",
                           find_response(model), " model"),
          col.names = c(emm_contr$emmeans@roles$predictors[2],
                        str_replace_all(emm_contr$emmeans@roles$predictors[1], "_", " "),
                        "EMM", 
                        "$SE$", 
                        "$2.5\\%CI$", 
                        "$97.5\\%CI$", 
                        "Difference", 
                        "$SE$", 
                        "$z$", 
                        "$p$"), 
          escape = FALSE) |> 
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    add_header_above(header = headers) |> 
    collapse_rows(1,
                  latex_hline = "major",
                  row_group_label_position = "first") |> 
    footnote(general = "EMM = estimated marginal mean. No degrees of freedom are reported, 
             as an asymptotic method was used. Because of this, \\\\textit{z} rather than 
             \\\\textit{t} scores are reported. Significant effects are in bold.",
             threeparttable = TRUE, 
             footnote_as_chunk = TRUE, 
             escape = FALSE)
}
```

### `full.contr`

This function takes a model, and creates an table of estimated marginal means and contrast between responses to masculinized and feminized responses by another variable, formatted in \LaTeX.

```{r}
full.contr <- function(model, emm_contr) {
  
  headers <- c(7, 4)
  names(headers) <- c(" ", 
                      paste0("Contrasts (",
                             first(data.frame(emm_contr$contrast)$contrast),
                             ")"))
  
  merge(data.frame(emm_contr$emmeans),
        data.frame(emm_contr$contrast) |>
          mutate(p.value = pval.lev(p.value)) |> 
          add_row(.after = 1) |> add_row(.after = 3) |>
          add_row(.after = 5) |> add_row() |> 
          mutate(contrast = "Masculinized - Feminized"),
        by = 0) |>
    rename_with(~ str_remove_all(., ".x")) |> 
    select(4,3,2,5,6,8,9,13,14,16,17) |> 
    kable(digits = 2, 
          booktabs = TRUE, 
          align = c(rep("l",3), rep("c",8)),
          linesep ="", 
          caption = paste0("Estimated marginal and constrast between masculinized and feminized 
                           stimuli by Relationship and Conditionfor the ",
                           find_response(model), " model"),
          col.names = c(emm_contr$emmeans@roles$predictors[3],
                        emm_contr$emmeans@roles$predictors[2],
                        "Sexual dimorphism",
                        "EMM", 
                        "$SE$", 
                        "$2.5\\%CI$", 
                        "$97.5\\%CI$", 
                        "Difference", 
                        "$SE$", 
                        "$z$", 
                        "$p$"), 
          escape = FALSE) |> 
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    add_header_above(header = headers) |> 
    collapse_rows(c(1:2,8),
                  latex_hline = "major",
                  row_group_label_position = "first") |> 
    footnote(general = "EMM = estimated marginal mean. No degrees of freedom are reported, 
             as an asymptotic method was used. Because of this, \\\\textit{z} rather than 
             \\\\textit{t} scores are reported. Significant effects are in bold.",
             threeparttable = TRUE, 
             footnote_as_chunk = TRUE, 
             escape = FALSE)
}
```

### `mods.comp`

This function takes a group of comparable models, and creates an table $AICc$ values, including deltas and Akaike weights, formatted in \LaTeX.

```{r}

mods.comp <- function(base.model) {
  
  model.names <- c(base.model, paste0(base.model, letters[1:5]))
  
  model.list <- lapply(model.names, get)
  
  comp <- AICctab(model.list,
                  base = TRUE, 
                  weights = TRUE,
                  mnames = model.names)
  
  tab <- data.frame(AICctab(model.list,
                            base = TRUE,
                            weights = TRUE,
                            mnames = c("(No covariate)",
                                       "Men perceived as dangerous",
                                       "IPPV",
                                       "IPSV",
                                       "Infidelity",
                                       "Perceived home safety"))) |> 
    rownames_to_column(var = "Model (by covariate)") |> 
    mutate("$Prob.$" = paste0("1 / ", number(max(weight)/weight, big.mark = ",")),
           AICc = number(AICc, big.mark = ","),
           weight = small.lev(weight)) |> 
    rename("$AICc$" = "AICc",
           "$\\Delta(AICc)$" = "dAICc",
           "$w(AICc)$" = "weight") |> 
    select(-c(df))
  
  caption <- paste0("AICc comparison of ", 
                    find_response(model.list[[1]]), 
                    " models with different covariates")
  
  taa <- kable(tab,
               digits = 2,
               booktabs = TRUE,
               align = c("l", rep("c", 3), "r"),
               linesep = "",
               caption = caption,
               escape = FALSE) |>
    kable_styling(latex_options = c("HOLD_position")) |> 
    footnote(general = "IPPV = Intimate Partner Physical Violence; 
             IPSV = Intimate Partner Sexual Violence.
             Models are sorted according tho their $AICc$ values, increasingly, 
             so that the best model (lowest $AICc$) is always at the top. 
             $\\Delta(AICc)$ is the $AICc$ difference from each model to the best (top) model. 
             $w(AICc)$, are Akaike weights, which represent the 'weight of evidence'
             (\\\\cite{portetPrimerModelSelection2020}) of each model for being the best model 
             of the collection, given the data. 
             Similarly, \\\\textit{Prob.} refers to the probability of each model of being the 
             best model, in relation the the best-supported (top) model, expressed as a 
             fraction. For the model with no covariates, \\\\textit{df} = 13; for all models 
             with covariates, \\\\textit{df} = 21.",
             threeparttable = TRUE, 
             footnote_as_chunk = TRUE, 
             escape = FALSE)
  
  return(list(tab = tab, kab = taa, comp = comp))
}
```

### `plot.exp`

This function takes a model, and creates a plot that shows the estimated marginal means.

```{r}
cond_labs <- c("Condition: High", "Condition: Low")
names(cond_labs) <- c("High", "Low")

plot.exp <- function(model, y.pos, y.lab) {
  
  emms_mod <- as.data.frame(emmeans(model,
                                    ~ Sexual_dimorphism + Condition + Relationship))
  
  contr_mod <- as.data.frame(pairs(emmeans(model,
                                           ~ Sexual_dimorphism | Condition + Relationship))) |>
    separate(contrast, c("group1", "group2"), " - ") |>
    mutate(p.signif = stars.pval(p.value))
  
  plo <- ggplot(emms_mod, aes(y = emmean, x = Sexual_dimorphism, color = Relationship)) +
    geom_errorbar(aes(ymin = emmean-SE,
                      ymax = emmean+SE,
                      group = Relationship), 
                  color = "black",
                  width=.2,
                  position = position_dodge(0.3)) +
    geom_point(position = position_dodge(0.3), size = 2) +
    geom_line(aes(group = Relationship),
              position = position_dodge(0.3)) + 
    stat_pvalue_manual(contr_mod, 
                       label = "p.signif", 
                       y.position = y.pos,
                       color = "Relationship", hide.ns = TRUE,
                       position = position_dodge(),
                       tip.length = 0) +
    labs(y = y.lab,
         x = NULL) +
    facet_grid(~ Condition,
               labeller = labeller(Condition = cond_labs)) 
  
  return(plo)
}
```

### `plot.best.mod`

This function takes a model with a covariate, and creates a plot that shows the estimated marginal means by levels of the covariate.

```{r}
plot.best.mod <- function(best_model, y.pos, y.lab) {
  
  ifelse(class(best_model) == "lmerModLmerTest" |
           class(best_model) == "glmerMod",
           covar_best_mod <- best_model@frame |> 
             select(where(is.numeric)) |> 
             select(-1),
           covar_best_mod <- best_model$model |> 
             select(where(is.numeric)) |> 
             select(-1))
  
  covar_name <- colnames(covar_best_mod) |>
    str_replace_all("_", " ") |> 
    str_remove_all("Freq partner") |> 
    str_to_sentence() |> 
    str_trim()
  
  covar_best_mod_levels <- c(min(covar_best_mod[,1]),
                             max(covar_best_mod[,1]))
  
  covar_labs <- paste0(covar_name,
                       c("\nMin = ", "\nMax = "),
                       round(covar_best_mod_levels, 3))
  
  names(covar_labs) <- covar_best_mod_levels
  
  cond_labs <- c("Condition: High", "Condition: Low")
  names(cond_labs) <- c("High", "Low")
  
  emms_best_mod <- as.data.frame(
    emmeans(
      best_model,
      ~ Sexual_dimorphism + Condition + Relationship + Freq_partner_physical_violence,
      at = list(Freq_partner_physical_violence = covar_best_mod_levels))) |> 
    mutate(Freq_partner_physical_violence = round(Freq_partner_physical_violence, 3))
  
  contr_best_mod <- as.data.frame(
    pairs(
      emmeans(
        best_model,
        ~ Sexual_dimorphism | Condition + Relationship + Freq_partner_physical_violence,
        at = list(Freq_partner_physical_violence = covar_best_mod_levels)))) |>
    separate(contrast, c("group1", "group2"), " - ") |> 
    mutate(p.signif = stars.pval(p.value))
  
  best_mod_plot <- ggplot(emms_best_mod, 
                          aes(y = emmean, x = Sexual_dimorphism, color = Relationship)) +
    geom_errorbar(aes(ymin = emmean-SE,
                      ymax = emmean+SE,
                      group = Relationship), 
                  color = "black",
                  width=.1,
                  position = position_dodge(0.3)) +
    geom_point(position = position_dodge(0.3), size = 1) +
    geom_line(aes(group = Relationship),
              position = position_dodge(0.3)) + 
    stat_pvalue_manual(contr_best_mod, label = "p.signif", 
                       y.position = y.pos,
                       color = "Relationship", hide.ns = TRUE,
                       position = position_dodge(),
                       tip.length = 0) +
    labs(y = y.lab,
         x = NULL) +
    facet_grid(Condition ~ Freq_partner_physical_violence,
               labeller = labeller(Condition = cond_labs,
                                   Freq_partner_physical_violence = covar_labs))
  return(best_mod_plot)
}
```


## Independent stimuli evaluation

The sex typicality of all stimuli was manipulated to either enhance or reduce their sex-typical characteristics. Since all the stimuli were male faces, this involved masculinizing them to increase their typical sex characteristics and feminizing them to reduce those characteristics. Masculinized and feminized versions were independently rated for masculinity and estimated age by a panel of raters (not participants).

```{r}
# Load the 'Evaluacion Manipulación Rostros.xlsx' Excel file into a data frame
ext_val <- read_excel("Data/Evaluacion Manipulación Rostros.xlsx")
```

### Masculinity ratings

First, masculinity rating given to the masculinized and feminized versions of each stimuli were compared.

```{r}
# Select relevant columns and reshape the data into long format
masc_dat <- ext_val |>
  select(
    ResponseId,
    contains("M", ignore.case = FALSE), # Select columns that contain "M" (masculinity)
    -Menstruacion
  ) |> # Exclude the 'Menstruacion' (menstruation) column
  pivot_longer(
    cols = contains("M", ignore.case = FALSE), # Reshape to long format
    names_to = "Stimulus", # Column with stimuli names
    values_to = "Masculinity"
  ) |> # Column with masculinity ratings
  # Add a column indicating sexual dimorphism based on stimulus name
  mutate(Sexual_dimorphism = ifelse(grepl("f_1", Stimulus), "Feminine", "Masculine")) |>
  # Keep only the first 3 characters of the stimulus name
  mutate(Stimulus = str_sub(Stimulus, end = 3))

# Group by stimulus and perform t-tests for masculinity ratings across
# sexual dimorphism categories
t_masc <- masc_dat |>
  group_by(Stimulus) |>
  summarise(
    t = round(t.test(Masculinity ~ Sexual_dimorphism)$statistic, 2), # Compute t values
    p = pval.lev(t.test(Masculinity ~ Sexual_dimorphism)$p.value)
  ) |> # Compute p-value
  ungroup()

# Select the first 10 rows of the data 't_masc'
t_masc[1:10, ] |>
  # Add the next 10 rows (11 to 20) as additional columns
  cbind(t_masc[11:20, ]) |>
  # Add the next 10 rows (21 to 30) as additional columns
  cbind(t_masc[21:30, ]) |>
  # Create a table using the 'kable' function
  kable(
    booktabs = TRUE, # Use 'booktabs' style for better-looking tables in LaTeX
    digits = 2, # Round numerical values to 2 decimal places
    align = "c", # Center align all columns
    linesep = "", # No lines between rows
    caption = "Difference in independent masculinity ratings given to each stimulus,
               according to its sexual dimorphism manipulation (feminized - masculinized)",
    # Caption for the table
    escape = FALSE, # Allow LaTeX commands in the table (e.g., italic or bold)
    col.names = rep(c("Stimulus", "$t$", "$p$"), times = 3) # Column names
  ) |>
  # Apply additional LaTeX styling to the table using 'kable_styling'
  kable_styling(
    latex_options = c("HOLD_position", "scale_down") # Keep table position
  ) |>
  # Add vertical lines after the 3rd and 6th columns using 'column_spec'
  column_spec(c(3, 6), border_right = TRUE) |>
  # Add a footnote with specific formatting
  footnote(
    general = "Tests are Welch's \\\\textit{t}-test. Significant effects are in bold.",
    # General footnote text with LaTeX formatting
    threeparttable = TRUE, # Enable three-part table for better layout
    footnote_as_chunk = TRUE, # Render footnote as a chunk
    escape = FALSE # Allow LaTeX commands in the footnote
  )
```

### Age ratings

Then, estimated age of stimuli was assessed.

```{r}
# Process age-related data: select relevant columns and reshape into long format
age_dat <- ext_val |>
  select(
    ResponseId,
    contains("E", ignore.case = FALSE)
  ) |> # Select columns related to estimated age (E)
  select(-c(2:5)) |> # Exclude columns 2 to 5 (irrelevant for this analysis)
  pivot_longer(
    cols = contains("E", ignore.case = FALSE), # Reshape to long format
    names_to = "Stimulus", # Column with stimuli names
    values_to = "Age"
  ) |> # Column with age estimates
  # Add sexual dimorphism category based on stimulus name
  mutate(Sexual_dimorphism = ifelse(grepl("f_1", Stimulus), "Feminine", "Masculine")) |>
  # Keep only the first 3 characters of the stimulus name
  mutate(Stimulus = str_sub(Stimulus, end = 3))

# Summarize age data: compute mean, standard deviation, minimum, and maximum age
sum_age_dat <- age_dat |>
  summarise(
    Mean = mean(Age, na.rm = TRUE), # Mean age
    SD = sd(Age, na.rm = TRUE), # Standard deviation of age
    Min = min(Age, na.rm = TRUE), # Minimum age
    Max = max(Age, na.rm = TRUE)
  ) # Maximum age
```

#### Histogram of perceived age

Distribution of the estimated ages.

```{r estimated-age-hist, message = FALSE, warning = FALSE, results = "hold", fig.cap = paste0("Histogram of estimated age of stimuli by an independent panel of raters. Age estimations were between ", sum_age_dat$Min, " and ", sum_age_dat$Max, " with a mean of ", round(sum_age_dat$Mean, 2), " ± ", round(sum_age_dat$SD, 2),"."), fig.width = 5, fig.height = 3}
# Create a histogram of estimated age
ggplot(age_dat, aes(x = Age)) +
  geom_histogram(bins = 26, fill = "#6D9EC1", color = "black") + # Plot histogram with 26 bins
  labs(
    x = "Estimated Age", # X-axis label
    y = "Count"
  ) + # Y-axis label
  scale_x_continuous(breaks = seq(15, 40, 5)) # X-axis scale with breaks every 5 units
```

## Load and wrangle main experiment data

### Individual databases (by data type/source)

#### Eye-tracking data

```{r}
# Load the 'CUC-UB' sheet from the 'BD-ET-CUC-UB.xlsx' dataset
dat_et <- read_excel("Data/BD-ET-CUC-UB.xlsx",
                     sheet = "CUC-UB"
) |>
  # Drop unused columns
  select(-c(
    Participant, Condicion, TOI, Interval, Media_respuesta, AOI,
    AOI_Global, Respuesta, Number_of_mouse_clicks...17,
    Time_to_first_mouse_click...18, AOI_respuesta
  )) |>
  # Rename columns (to English)
  rename(
    ID = Recording,
    University = UNIVERSIDAD,
    Stimulus = Media,
    Condition = Condición,
    Relationship = Contexto,
    Sexual_dimorphism = Rostro,
    TFD = Total_duration_of_whole_fixations,
    NF = Number_of_whole_fixations,
    TFF = Time_to_first_whole_fixation,
    NMC = Number_of_mouse_clicks...21,
    TFMC = Time_to_first_mouse_click...22,
    DFF = Duration_first_fixation
  ) |>
  # Convert character columns to factors
  mutate(across(where(is.character), as.factor)) |>
  # Recode factor levels to more meaningful English labels
  mutate(
    Condition = fct_recode(Condition,
                           "Low" = "BAJA",
                           "High" = "ALTA"
    ),
    Relationship = fct_recode(Relationship,
                              "Short term" = "CP",
                              "Long term" = "LP"
    ),
    Sexual_dimorphism = fct_recode(Sexual_dimorphism,
                                   "Feminized" = "Feminizado",
                                   "Masculinized" = "Masculinizado"
    )
  ) |>
  # Modify 'Stimulus' column to include 'F' for Feminized and 'M' for Masculinized
  mutate(
    Stimulus = ifelse(Sexual_dimorphism == "Feminized",
                      paste0(str_sub(str_replace(Stimulus, ".* - ", ""), 1, 2), "F"),
                      ifelse(Sexual_dimorphism == "Masculinized",
                             paste0(str_sub(str_replace(Stimulus, ".* - ", ""), 1, 2), "M"),
                             Stimulus
                      )
    ),
    # Create a new column 'CF' to indicate whether there was a mouse click
    CF = ifelse(NMC == 0, "No", "Yes")
  )
```

#### Questionnaires

This was loaded without calculating total instrument scores (for now), to test internal consistency

```{r}
quests <- read_excel("Data/Cuestionario Datos Sociodemográficos  (Disponibilidad) (respuestas) (1).xlsx",
                     sheet = "Respuestas de formulario 1"
) |>
  # Drop unnecessary columns (such as 'Invitado', 'Servicios ayuda', and 'Correos cierre')
  select(-c(Invitado, `Servicios ayuda`, `Correos cierre`)) |>
  # Rename columns for better readability
  rename(
    Date = Fecha,
    Age = edad,
    City = Ciudad,
    Education = Escolaridad,
    Ethnicity = Etnia,
    Gender = Sexo,
    Sex = Genero,
    Sexual_orientation = OS,
    Relationship_current = "Pareja actual",
    Relationship_duration = DuracionR,
    Relationship_status = EstadoR,
    Partner_sex = SexoParejaActual,
    Partner_masculinity = Masculinidad_pareja,
    Partner_dominance = Dominancia_pareja,
    Partner_attractiveness = Atractivo_pareja,
    Number_of_children = NumHijos,
    Hormonal_contraception = "Anticonceptivos hormonales",
    Contraceptive = Cual_anticonceptivo,
    Last_mentruation = "Ultima menstruacion",
    Currently_pregnant = "Embarazo actual",
    Sexual_abuse = "Experiencia abuso sexual",
    Comments = comentarios1,
    Medical_history = "antecedentes medicos",
    SP_happiness = "AP felicidad",
    SP_financial_security = "AP seguridad economica",
    SP_money_control = "AP control dinero",
    SP_attractiveness = "AP atractivo",
    SP_self_confidence = "AP autoconfianza",
    SP_self_esteem = "AP autoestima",
    SP_health = "AP salud",
    Electricity = "SB electricidad",
    Internet_access = "SB internet",
    TV = "SB television",
    Internet_use = "Fr acceso internet",
    Hospital_access = "Acceso hospital",
    Freq_illness = "Fr enfermedades",
    Socioeconomic_level = "Estrato socioeconomico",
    Neighborhood = "Barrio de residencia",
    Perceived_neighborhood_safety = "Seguridad barrio",
    Perceived_city_safety = "Seguridad ciudad",
    Perceived_home_safety = "Seguridad hogar",
    Perceived_country_safety = "Seguridad país",
    Freq_robery = "Fr de robos",
    Men_perceived_as_danger_to_children = "Hombres peligrosos hijos",
    Men_perceived_as_danger_to_partner = "Hombres peligrosos pareja",
    Partner_physical_violence = "VP fisica",
    Freq_partner_physical_violence = "Fr VP fisica",
    Partner_sexual_violence = "VP sexual",
    Freq_partner_sexual_violence = "Fr VP sexual",
    Partner_infidelity = "Infidelidad",
    Freq_partner_infidelity = "Fr infidelidad",
    Victim_of_violence = "Victima de alguna violencia",
    Violence_type = "Tipo violencia",
    Victim_of_gender_violence = "Victima violencia género",
    Victim_of_armed_conflict = "Victima conflicto armado",
    Control_question_1 = "Sin leer",
    Control_question_2 = "Broma"
  ) |>
  # Recode the factor levels of several categorical variables
  mutate(
    Education = factor(Education, levels = c(
      "Primaria",
      "Bachillerato",
      "Universitario",
      "Posgrado"
    )),
    Sexual_orientation = factor(Sexual_orientation,
                                levels = c(
                                  "Exclusivamente heterosexual",
                                  "Principalmente heterosexual, con contactos homosexuales esporádicos",
                                  "Predominantemente heterosexual, aunque con contactos homosexuales más que esporádicos",
                                  "Bisexual",
                                  "Pansexual",
                                  "Demisexual"
                                )
    ),
    Relationship_status = factor(Relationship_status,
                                 levels = c(
                                   "Soltero sin contactos sexuales en el último año",
                                   "Soltero con contactos sexuales en el último año",
                                   "Relación exclusiva o matrimonio - viven juntos",
                                   "Relación exclusiva - no viven juntos",
                                   "Relación no exclusiva - contactos sexuales con otras personas"
                                 )
    ),
    Internet_use = factor(Internet_use,
                          levels = c("Cada día", "Cada mes", "Cada año")
    ),
    Socioeconomic_level = as.factor(Socioeconomic_level)
  ) |>
  # Recode City variable to simplify geographical information
  mutate(City = ifelse(City %in% c(
    "Bogotá D.C.", "Madrid, Cundinamarca", "Zipaquirá, Cundinamarca",
    "Zipaquirá", "Mosquera, cundinamarca", "Mosquera",
    "FUNZA, CUNDINAMARCA", "Madrid Cundinamarca", "Une- Cundinamarca"
  ),
  "Bogota Region",
  ifelse(City %in% c(
    "Soledad", "Barranquilla", "BARRANQUILLA",
    "Soledad, Atlantico", "Costa Atlantica", "Corozal"
  ),
  "Atlantico Region",
  "Other"
  )
  )) |>
  # Recode several factors from Spanish to English for easier interpretation
  mutate(Education = recode(Education,
                            "Primaria" = "Primary school",
                            "Bachillerato" = "High school",
                            "Universitario" = "University",
                            "Posgrado" = "Postgraduate"
  )) |>
  # Additional recoding of variables
  mutate(Sexual_orientation = recode(Sexual_orientation,
                                     "Exclusivamente heterosexual" =
                                       "Exclusively heterosexual",
                                     "Principalmente heterosexual, con contactos homosexuales esporádicos" =
                                       "Predominantly heterosexual",
                                     "Predominantemente heterosexual, aunque con contactos homosexuales más que esporádicos" =
                                       "Predominantly heterosexual, but more than incidentally homosexual",
                                     "Bisexual" = "Bisexual",
                                     "Pansexual" = "Pansexual",
                                     "Demisexual" = "Demisexual"
  )) |>
  mutate(Relationship_status = recode(Relationship_status,
                                      "Soltero sin contactos sexuales en el último año" =
                                        "Single without sexual contacts",
                                      "Soltero con contactos sexuales en el último año" =
                                        "Single with sexual contacts",
                                      "Relación exclusiva o matrimonio - viven juntos" =
                                        "Exclusive relationship - cohabitating",
                                      "Relación exclusiva - no viven juntos" =
                                        "Exclusive relationship - not cohabitating",
                                      "Relación no exclusiva - contactos sexuales con otras personas" =
                                        "Non-exclusive relationship"
  )) |>
  mutate(Internet_use = recode(Internet_use,
                               "Cada día" = "Daily",
                               "Cada mes" = "Monthly",
                               "Cada año" = "Yearly"
  )) |>
  # Recode several questions related to danger perceptions, replacing Spanish responses with
  # numerical values.
  mutate(across(
    starts_with("Men_perceived_as_danger_to_"),
    ~ recode(.,
             "Completamente en desacuerdo" = 1,
             "Ligeramente en desacuerdo" = 2,
             "Ni de acuerdo ni en desacuerdo" = 3,
             "Ligeramente deacuerdo" = 4,
             "Completamente deacuerdo" = 5
    )
  )) |>
  # Replace Spanish responses with corresponding English values
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Si",
    "Yes"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Sí",
    "Yes"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "No quiero responder",
    "Prefer not to answer"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Mujer",
    "Woman"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Hombre",
    "Man"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Femenino",
    "Female"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Masculino",
    "Male"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Sin pareja actual",
    "Single"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Sí, una vez en la adultez",
    "Once as adult"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Sí, tanto en la infancia como en la adultez",
    "Both as child and adult"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Sí, más de una vez en mi infancia",
    "More than once as child"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Sí, una vez e mi infancia",
    "Once as child"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Afrocolombiano",
    "Afrocolombian"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Desplazado conflicto armado",
    "Undetermined"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Ninguna",
    "Undetermined"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Comunidad negra",
    "Afrocolombian"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Raizal del Archipiélago de San Andrés, Providencia y Santa Catalina",
    "Raizal"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Patos",
    "Indigenous"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "Indígena",
    "Indigenous"
  ))) |>
  mutate(across(where(is.character), ~ replace(
    ., . ==
      "No estoy segura",
    "Unsure"
  )))
```

##### Principal component analysis (PCA)

To test whether it was possible to reduce the number of socio-ecological variables, we performed PCAs using the package FactoMineR [@factominercit], and plotted its results with function from the package factoextra [@factoextracit].

###### Socio-ecological factors PCA

```{r pca-sef-tab}
# Select relevant columns for PCA from the 'quests' dataset
quests_pca_gen <- quests |>
  select(
    ID, # Unique identifier
    Men_perceived_as_danger_to_partner,
    Men_perceived_as_danger_to_children,
    Freq_partner_physical_violence,
    Freq_partner_sexual_violence,
    Freq_partner_infidelity,
    Perceived_home_safety
  ) |>
  # Rename columns: replace "Freq_" with "Frequency of"
  rename_with(~ str_replace_all(., "Freq_", "Frequency of")) |>
  # Replace underscores with spaces in column names
  rename_with(~ str_replace_all(., "_", " ")) |>
  # Capitalize the first letter of each column name
  rename_with(~ str_to_sentence(.))

# Perform PCA on the selected variables (excluding the ID column)
pca_sef <- PCA(quests_pca_gen[, -1], graph = FALSE)

# Display summary of the PCA results
pca_sef$var$cor |>
  # Create a table using the 'kable' function
  kable(
    booktabs = TRUE, # Use 'booktabs' style for better-looking tables in LaTeX
    digits = 2, # Round numerical values to 2 decimal places
    align = "c", # Center align all columns
    linesep = "", # No lines between rows
    caption = "Correlation between variables and PCA dimensions",
    # Caption for the table
    escape = FALSE, # Allow LaTeX commands in the table (e.g., italic or bold)
  ) |>
  # Apply additional LaTeX styling to the table using 'kable_styling'
  kable_styling(
    latex_options = c("HOLD_position", "scale_down") # Keep table position
  )
```

**Summary plot**

```{r pca-sef-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Summary of the PCA for all socio-ecological factors. \\textbf{a.} Scree plot. \\textbf{b.} Factor loadings."}
# Arrange two plots side by side:
# 1. A scree plot showing the explained variance for each principal component
# 2. A plot showing the variable loadings on the principal components
ggarrange(
  fviz_eig(pca_sef, addlabels = TRUE, barfill = "#00AFBB") +
    labs(
      title = "PCA: Socio-ecological factors", # Title for the scree plot
      subtitle = "Scree plot" # Subtitle for the scree plot
    ),
  fviz_pca_var(pca_sef,
               col.var = "#00AFBB", # Color the variable loadings in teal
               repel = TRUE # Avoid overlapping labels
  ) +
    labs(
      title = NULL, # No title for the loading plot
      subtitle = "Loadings" # Subtitle for the loading plot
    ),
  labels = "auto"
)
```

When including all socio-ecological factors, the only variables that strongly correlate between them and with the PCA dimension (Table \@ref(tab:pca-sef-plot); Fig. \@ref(fig:pca-sef-plot)), are the two variables that evaluate participant's perception of men as dangerous to children and to their partner.

Because of this, a new PCA was performed or only these two variables, to calculate a score of Men perceived as dangerous.  All remaining socio-ecological variables were kept.

###### Men perceived as dangerous

```{r}
# Select relevant columns for PCA from the 'quests' dataset
quests_pca <- quests |>
  select(
    ID,
    Men_perceived_as_danger_to_partner,
    Men_perceived_as_danger_to_children
  ) |>
  # Rename columns: remove "Men_perceived_as_danger_to_"
  rename_with(~ str_remove_all(., "Men_perceived_as_danger_to_")) |>
  # Capitalize the first letter of each column name
  rename_with(~ str_to_sentence(.))


# Perform PCA on the selected variables (excluding the ID column)
pca_mpd <- PCA(quests_pca[, -1], graph = FALSE)

# Calculate score for the men perceived as dangerous dimension
mpd_scores <- data.frame(pca_mpd$ind$coord)$Dim.1

# Display summary of the PCA results
pca_mpd$var$cor |>
  # Create a table using the 'kable' function
  kable(
    booktabs = TRUE, # Use 'booktabs' style for better-looking tables in LaTeX
    digits = 2, # Round numerical values to 2 decimal places
    align = "c", # Center align all columns
    linesep = "", # No lines between rows
    caption = "Correlation between variables and PCA dimensions",
    # Caption for the table
    escape = FALSE, # Allow LaTeX commands in the table (e.g., italic or bold)
  ) |>
  # Apply additional LaTeX styling to the table using 'kable_styling'
  kable_styling(
    latex_options = c("HOLD_position", "scale_down") # Keep table position
  )
```

**Summary plot**

In fact, the two variables related to men perceived as dangerous, could be reduced to a single dimension, that captured over `r percent(pca_mpd$eig[1,2]/100)` of the variance.

```{r pca-mpd-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Summary of the PCA for factors related to men perceived as dangerous. \\textbf{a.} Scree plot. \\textbf{b.} Factor loadings."}
# Arrange two plots side by side:
# 1. A scree plot showing the explained variance for each principal component
# 2. A plot showing the variable loadings on the principal components
ggarrange(
  fviz_eig(pca_mpd, addlabels = TRUE, barfill = "#00AFBB") +
    labs(
      title = "PCA: Men perceived as danger to...", # Title for the scree plot
      subtitle = "Scree plot" # Subtitle for the scree plot
    ),
  fviz_pca_var(pca_mpd,
               col.var = "#00AFBB", # Color the variable loadings in teal
               repel = TRUE # Avoid overlapping labels
  ) +
    labs(
      title = NULL, # No title for the loading plot
      subtitle = "Loadings" # Subtitle for the loading plot
    ),
  labels = "auto"
)
```

##### Clean questionnaire data

Less columns, with total instrument scores

```{r}
# Clean and modify the 'quests' dataset
quests_clean <- quests |>
  # Recode values in columns that start with "Escasez alimentaria"
  mutate(across(
    starts_with("Escasez alimentaria"),
    ~ recode(.,
             "Nunca" = 0, # Recode "Nunca" to 0
             "Rara vez/algunas veces" = 1, # Recode "Rara vez/algunas veces" to 1
             "Casi siempre" = 2 # Recode "Casi siempre" to 2
    )
  )) |>
  # Perform row-wise operations
  rowwise() |>
  # Create new variables by summing up specific columns
  mutate(
    # Calculate Self-esteem score by summing relevant items (with reverse scoring)
    Self_esteem = sum(
      autoestima_I1, 5 - autoestima_I2, autoestima_I3, autoestima_I4,
      autoestima_I5, 5 - autoestima_I6, autoestima_I7, 5 - autoestima_I8,
      5 - autoestima_I9, autoestima_I10
    ),
    # Calculate Self-perception score by summing columns that start with "SP_"
    Self_perception = sum(across(starts_with("SP_"))),
    # Calculate Perceived safety by summing columns that end with "_safety"
    Perceived_safety = sum(across(ends_with("_safety"))),
    # Calculate Food insecurity by summing columns that start with "Escasez alimentaria"
    Food_insecurity = sum(across(starts_with("Escasez alimentaria")))
  ) |>
  # Remove columns that start with "autoestima_"
  select(!starts_with("autoestima_")) |>
  # Convert character columns to factors
  mutate(across(where(is.character), as.factor)) |>
  # Bind the column 'Men_perceived_as_dangerous' from 'mpd_scores' (PCA scores)
  bind_cols(Men_perceived_as_dangerous = mpd_scores)
```

#### Subjective evaluation of stimuli

##### Wide format

```{r}
# Load the subjective evaluation dataset, removing the last two columns (123 and 124)
eval <- read_excel("Data/Evaluación subjetiva rostros (Respuestas).xlsx") |>
  select(-c(123:124)) |>
  # Perform row-wise operations to compute new variables
  rowwise() |>
  # Calculate the sum of masculinity and attractiveness ratings for both masculinized and
  # feminized stimuli
  mutate(
    Masculinity_masculinized = sum(across(ends_with("M Mas"))),
    Masculinity_feminized = sum(across(ends_with("F Mas"))),
    Attractiveness_masculinized = sum(across(ends_with("M Atr"))),
    Attractiveness_feminized = sum(across(ends_with("F Atr")))
  ) |>
  # Rename columns for clarity
  rename(
    Date = "Marca temporal",
    ID = "Escribe tu código de participante"
  )
```

##### Long format

```{r}
# Create a long format dataset by combining attractiveness and masculinity ratings
eval_long <- left_join(
  # First, select relevant columns and pivot the attractiveness ratings to long format
  eval |>
    select(-c(123:126)) |> # Remove unnecessary columns
    select(!ends_with(" Mas")) |> # Exclude masculinity-related columns
    pivot_longer(
      cols = ends_with("Atr"), # Pivot attractiveness ratings to long format
      names_to = "Stimulus",
      values_to = "Attractiveness"
    ) |>
    mutate(Stimulus = str_remove_all(Stimulus, " Atr")), # Clean the Stimulus names
  # Next, pivot the masculinity ratings to long format
  eval |>
    select(-c(123:126)) |> # Remove unnecessary columns
    select(!ends_with(" Atr")) |> # Exclude attractiveness-related columns
    pivot_longer(
      cols = ends_with("Mas"), # Pivot masculinity ratings to long format
      names_to = "Stimulus",
      values_to = "Masculinity"
    ) |>
    mutate(Stimulus = str_remove_all(Stimulus, " Mas")) # Clean the Stimulus names
)
```

#### Resource availability

```{r}
reg <- rbind(
  read_excel("Data/3Registro Participantes Disponibilidad de Recursos-corregido.xlsx",
             sheet = "UB"
  ) |>
    mutate(University = "UB"),
  read_excel("Data/3Registro Participantes Disponibilidad de Recursos-corregido.xlsx",
             sheet = "CUC"
  ) |>
    mutate(University = "CUC")
) |>
  select(-c(
    Grupo, `Entrega de kit`, `Protocolo de bioseguridad`, `Requisitos previos al registro`, 
    Consentimiento, `Código de evaluador`:`Código auxiliar que reclutó`
  )) |>
  rename(
    Date = "Fecha de registro",
    ID = "Codigo del Participante",
    Condition = "Condicion",
    Calibration = "Calibración",
    Gaze_perc = "% Gaze",
    Condition_happiness = "Q Feliz",
    Condition_physical_safety = "Q Segura físicamente",
    Condition_healthy = "Q Saludable",
    Condition_economic_security = "Q Segura económicamente",
    Body_temperature = "Temperatura",
    Ovulating = "Test de ovulación",
    Saliva_pre = "Recolección de saliva pre",
    Saliva_pre_time = "Hora...18",
    Eye_tracking = "Rastreo Ocular",
    Subjective_evaluation = "Evaluación subjetiva",
    Sociodemographic_questionnaire = "Cuestionario sociodemográfico",
    Saliva_post = "Recolección de saliva post",
    Saliva_post_time = "Hora...23",
    Notes = "Observaciones"
  ) |>
  mutate(
    Condition = fct_recode(Condition,
                           "Low" = "Baja",
                           "High" = "Alta"
    ),
    Calibration = fct_recode(Calibration,
                             "<=0.5" = "<0.5 (menor a 0.5)",
                             ">0.5" = ">0.5 (mayor a 0.5)",
                             "<=0.5" = "0.5 (igual a 0.5)",
                             NULL = "Selecciona"
    ),
    Ovulating = fct_recode(as.factor(Ovulating),
                           "No" = "0",
                           "Yes" = "1"
    )
  ) |>
  mutate_all(~ str_replace_all(., "SI", "Yes")) |>
  mutate_all(~ str_replace_all(., "NO", "No")) |>
  mutate_all(~ str_replace_all(., "INCOMPLETO", "No")) |>
  mutate_all(~ str_replace_all(., "Recuperado", "Data recovered")) |>
  mutate_all(~ str_replace_all(., "RECUPERADO", "Data recovered")) |>
  mutate_all(~ na_if(., "Selecciona")) |>
  mutate_all(~ na_if(., "N/A")) |>
  mutate(across(starts_with("Condition_"), as.numeric))
```

### Full, final database

#### Join data files

```{r}
dat_int <- dat_et |>
  left_join(quests_clean, by = c("ID"), multiple = "all") |>
  left_join(eval_long, by = c("ID", "Stimulus"), multiple = "all") |>
  left_join(reg, by = c("ID", "University", "Condition"), multiple = "all")
```

#### Filtered database

Filtered database to exclude participants who did responded the two control questions correctly, were ovulating, or did not report being exclusively heterosexual.

```{r}
dat <- dat_int |>
  # Filter out rows where Control_question_1 and Control_question_2 are both "No",
  # Ovulating is not "Yes", and Sexual_orientation is "Exclusively heterosexual"
  filter(Control_question_1 == "No" &
           Control_question_2 == "No" &
           Ovulating != "Yes" &
           Sexual_orientation == "Exclusively heterosexual") |>
  # Remove all occurrences of the letter "F" from the Stimulus column
  # (infomation already in the column Sexual_dimorphism)
  mutate(Stimulus = str_remove_all(Stimulus, "F")) |>
  # Remove all occurrences of the letter "M" from the Stimulus column
  # (infomation already in the column Sexual_dimorphism)
  mutate(Stimulus = str_remove_all(Stimulus, "M")) |>
  # Sort Sexual_dimorphism levels, so that contrasts keep the same structure
  mutate(Sexual_dimorphism = fct_relevel(Sexual_dimorphism, "Masculinized")) |> 
  # Ensure that the resulting data frame is ungrouped
  ungroup()
```

After filtering the database and removing data who did not meet these criteria, from an initial sample size of `r summarise(dat_int, n = n_distinct(ID))` women, the final database contained data from `r summarise(dat, n = n_distinct(ID))` exclusively heterosexual participants, who were not ovulating.

### Final individual databases filtered to the final sample

#### Resource availability (filtered)

```{r}
reg_fin <- reg |>
  left_join(quests_clean, by = c("ID")) |>
  filter(ID %in% unique(dat$ID))
```

#### Questionnaires (filtered)

```{r}
quests_fin <- quests_clean |>
  filter(ID %in% unique(dat$ID))
```

# Descriptives

## Number and age of participants in each condition

```{r}
dat |>
  group_by(ID) |>
  summarise(
    Age = first(Age),
    Condition = first(Condition)
  ) |>
  ungroup() |>
  group_by(Condition) |>
  summarise(
    n = n_distinct(ID),
    Mean = mean(Age, na.rm = TRUE),
    SD = sd(Age, na.rm = TRUE),
    Min = min(Age, na.rm = TRUE),
    Max = max(Age, na.rm = TRUE)
  ) |>
  kable(
    booktabs = TRUE, # Use 'booktabs' style for better-looking tables in LaTeX
    digits = 2, # Round numerical values to 2 decimal places
    align = "c", # Center align all columns
    linesep = "", # No lines between rows
    caption = "Number and age of participants in each condition",
    # Caption for the table
    escape = FALSE, # Allow LaTeX commands in the table (e.g., italic or bold)
    col.names = c(
      "Condition",
      "\\textit{n}",
      "Mean",
      "SD",
      "Min.",
      "Max."
    )
  ) |>
  # Apply additional LaTeX styling to the table using 'kable_styling'
  kable_styling(
    latex_options = c("HOLD_position", "scale_down") # Keep table position
  )
```

## Select and wrangle data for descriptive plots

```{r}
# Create desc_quest, combining and transforming quests_fin and reg
desc_quest <-
  # Join the quests_fin and reg dataframes by ID
  quests_fin |>
  left_join(reg, by = c("ID")) |>
  # Select only the desired columns
  select(
    ID,
    Condition,
    Age,
    City,
    Education,
    Ethnicity,
    Sexual_orientation,
    Relationship_current,
    Relationship_status:Hormonal_contraception,
    Sexual_abuse,
    SP_happiness:Socioeconomic_level,
    Perceived_country_safety:Freq_robery,
    Victim_of_violence,
    Victim_of_gender_violence:Victim_of_armed_conflict,
    Self_esteem:Men_perceived_as_dangerous,
    Freq_partner_physical_violence,
    Freq_partner_infidelity,
    Partner_physical_violence,
    Partner_sexual_violence,
    Freq_partner_sexual_violence,
    # Food security variables (transformed later)
    "Escasez alimentaria1":"Escasez alimentaria5"
  ) |>
  # Transform all 'Escasez alimentaria' (food scarcity) columns into categorical variables with 
  # specific levels.
  mutate(
    across(
      starts_with("Escasez alimentaria"),
      ~ recode(.,
               "0" = "Never",
               "1" = "Rarely/sometimes",
               "2" = "Almost always"
      )
    ),
    # Convert character variables to factor for clarity and consistency.
    across(where(is.character), as.factor),
    # Sort factor levels
    across(
      starts_with("Escasez alimentaria"),
      ~ factor(.,
               levels = c(
                 "Never",
                 "Rarely/sometimes",
                 "Almost always"
               )
      )
    )
  )
```

## Distribution of values across variables

### Sociodemographic variables

```{r sociodemographic-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across sociodemographic variables, by condition. \\textbf{a.} Distribution of values across numeric sociodemographic variables. Colored vertical lines indicate the mean value for each variable under each condition. \\textbf{b.} Proportional number of participants across categorical variables.", fig.height = 6}
# Create a plot that displays the distribution of sociodemographic factors
# by condition, with subplots for numeric and categorical variables.
ggarrange(
  # Plot a: Distribution of values across numeric sociodemographic variables
  desc_quest |>
    select(ID, Condition, Age, Number_of_children) |>
    # Convert data from long to wide format to prepare for plotting
    pivot_longer(where(is.numeric),
                 names_to = "Variable",
                 values_to = "Value") |> 
    # Clean and transform the variable names by replacing underscores with spaces
    mutate(Variable = str_replace_all(Variable, "_", " ")) |>
    # Create a plot of density distributions for numeric variables, 
    # colored and filled by condition
    ggplot(aes(x = Value, fill = Condition, color = Condition)) +
    geom_density(alpha = 0.3) +  # Use semi-transparent density curves
    facet_wrap(~Variable, scales = "free", ncol = 1) +  # Display variables in separate panels
    stat_summary(aes(xintercept = after_stat(x), y = 0),
                 fun = mean, geom = "vline", orientation = "y") +  # Add vertical lines at mean
    labs(x = NULL, y = NULL),  # Remove axis labels for this panel
  # Plot b: Proportional number of participants across categorical variables
  desc_quest |> 
    select(ID, Condition, City, Ethnicity, 
           Education, Relationship_current, Relationship_status) |> 
    # Convert data from long to wide format to prepare for plotting
    pivot_longer(City:Relationship_status,
                 names_to = "Variable",
                 values_to = "Value") |> 
    # Clean and transform the variable names by replacing underscores with spaces
    mutate(Variable = str_replace_all(Variable, "_", " ")) |> 
    # Create a plot of bar charts for categorical variables, 
    # colored and filled by condition
    ggplot(aes(y = Value, fill = Condition, color = Condition)) +
    geom_bar(alpha = 0.3, position = position_dodge()) +  # Use semi-transparent bars
    # Add text labels to display proportional values as percentages
    geom_text(aes(label = scales::percent(after_stat(prop), accuracy = 0.1)),
              xjust = "inward",
              position = position_dodge(.9),
              stat = "prop",
              color = "black",
              size = 3) +
    facet_wrap(~Variable, scales = "free") +  # Display variables in separate panels
    scale_y_discrete(labels = label_wrap(20)) +  # Wrap long labels for categorical axes
    theme(axis.text.y = element_text(size = 8)) +  # Reduce font size for y-axis text
    labs(x = NULL, y = NULL),  # Remove axis labels for this panel
  # Arrange subplots into a grid with specified widths and share legends
  widths = c(1, 3),
  common.legend = TRUE,
  legend = "bottom",
  labels = "auto"
)
```

### Access to resources

```{r resource-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Proportional number of participants across categorical variables that measure access to resources.", fig.height = 6}
# Create a plot that displays the distribution of socioeconomic factors
# by condition.
ggarrange(
  # Select relevant variables from the dataset (desc_quest)
  desc_quest |> 
    select(ID, Condition,
           Socioeconomic_level, Electricity, Internet_access, Internet_use,
           TV, Hospital_access) |>
    # Convert data from long to wide format to prepare for plotting
    pivot_longer(Socioeconomic_level:Hospital_access,
                 names_to = "Variable",
                 values_to = "Value") |> 
    # Clean and transform the variable names by replacing underscores with spaces
    mutate(Variable = str_replace_all(Variable, "_", " ")) |>
    # Create a plot of bar charts for socioeconomic variables, 
    # colored and filled by condition
    ggplot(aes(y = Value, fill = Condition, color = Condition)) +
    geom_bar(alpha = 0.3, position = position_dodge()) +  # Use semi-transparent bars
    # Add text labels to display proportional values as percentages
    geom_text(aes(label = scales::percent(after_stat(prop), accuracy = 0.1)),
              xjust = "inward",
              position = position_dodge(.9),
              stat = "prop",
              color = "black",
              size = 3) +
    facet_wrap(~Variable, scales = "free") +  # Display variables in separate panels
    scale_y_discrete(labels = label_wrap(20)) +  # Wrap long labels for categorical axes
    theme(axis.text.y = element_text(size = 8)) +  # Reduce font size for y-axis text
    labs(x = NULL, y = NULL),  # Remove axis labels
  # Arrange subplots into a grid with specified widths and share legends
  widths = c(1, 3),
  common.legend = TRUE,
  legend = "bottom"
)
```

### Health-related variables

```{r health-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across numeric health-related variables. Colored vertical lines indicate the mean value for each variable under each condition.", fig.height = 6}
ggarrange(
  # Select relevant columns from desc_quest and pivot them into a long format 
  desc_quest |>
    select(ID, Condition, Freq_illness, SP_health) |>
    # Convert the Frequency of illness and Self-perceived health columns into separate rows
    pivot_longer(Freq_illness:SP_health,
                 names_to = "Variable",
                 values_to = "Value") |> 
    # Clean up variable names by replacing underscores with spaces
    mutate(Variable = str_replace_all(Variable, "_", " ")) |>
    # Rename variables
    mutate(Variable = str_replace_all(Variable, "Freq", "Frequency of")) |>
    mutate(Variable = str_replace_all(Variable, "SP", "Self-perceived")) |>
    # Convert the Value column to numeric
    mutate(Value = as.numeric(Value)) |> 
    # Create a ggplot object
    ggplot(aes(x = Value, fill = Condition, color = Condition)) +
    # Plot density curves for each condition within each variable
    geom_density(alpha = 0.3) +
    # Divide the plot into facets by Variable
    facet_wrap(~Variable) +
    # Add vertical lines to indicate mean values for each group
    stat_summary(aes(xintercept = after_stat(x), y = 0),
                 fun = mean, geom = "vline", orientation = "y") +
    # Set up plot labels and title with NULL values for x and y axes.
    labs(x = NULL, y = "Density"),
  # Specify the widths of the two columns and common legend position (bottom)
  widths = c(2, 1),
  common_legend = TRUE,
  legend = "bottom")
```

### Food security

```{r foodsec-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across food security variables, by condition. \\textbf{a.} Proportional number of participants across ordinal items. \\textbf{b.} Distribution of values for the toital score. Colored vertical lines indicate the mean value for participants in each condition.", fig.height = 6}
ggarrange(
  # Select columns from desc_quest, including 'Escasez alimentaria' (food scarcity)
  desc_quest |>
    select(ID, Condition, "Escasez alimentaria1":"Escasez alimentaria5") |>
    # Pivot the Escasez alimentaria1 to Escasez alimentaria5 columns into a long format
    pivot_longer("Escasez alimentaria1":"Escasez alimentaria5",
                 names_to = "Variable",
                 values_to = "Value") |>
    # Clean up variable names
    mutate(Variable = str_replace_all(Variable, "Escasez alimentaria", "")) |>
    mutate(Variable = str_replace_all(Variable, "1", "1. Smaller food portions")) |>
    mutate(Variable = str_replace_all(Variable, "2", "2. Reduced number of meals")) |>
    mutate(Variable = str_replace_all(Variable, "3", "3. Food scarcity at home")) |>
    mutate(Variable = str_replace_all(Variable, "4", "4. Sleeping with hunger")) |>
    mutate(Variable = str_replace_all(Variable, "5", "5. Day and night without eating")) |>
    # Create a ggplot object for the first set of data
    ggplot(aes(y = Value, fill = Condition, color = Condition)) +
    # Plot bar charts for each condition within each variable
    geom_bar(alpha = 0.3, position = position_dodge()) +
    # Add text labels on top of the bars showing the proportion of each category
    geom_text(aes(label = scales::percent(after_stat(prop), accuracy = 0.1)),
              vjust = "inward",
              position = position_dodge(.9),
              stat = "prop",
              color = "black",
              size = 2.5) +
    # Divide the plot into facets by Variable
    facet_wrap(~Variable, scales = "free") +
    # Set labels for the y-axis with a maximum width of 20 characters
    scale_y_discrete(labels = label_wrap(20)) +
    # Adjust the text size of the y-axis
    theme(axis.text.y = element_text(size = 8)) +
    labs(x = NULL, y = NULL, title = "Items"),
  # Select columns from desc_quest dataframe, including Food_insecurity column
  desc_quest |>
    select(ID, Condition, Food_insecurity) |>
    # Convert the Food_insecurity column into long format
    pivot_longer(Food_insecurity,
                 names_to = "Variable",
                 values_to = "Value") |>
    # Convert the Value column to numeric
    mutate(Value = as.numeric(Value)) |>
    # Clean up variable names
    mutate(Variable = str_replace_all(Variable, "_", " ")) |>
    # Create a ggplot object for the second set of data
    ggplot(aes(x = Value, fill = Condition, color = Condition)) +
    # Plot density curves for each condition within each variable
    geom_density(alpha = 0.3) +
    # Divide the plot into facets by Variable
    facet_wrap(~Variable) +
    # Add vertical lines to indicate mean values
    stat_summary(aes(xintercept = after_stat(x), y = 0),
                 fun = mean, geom = "vline", orientation = "y") +
    labs(x = NULL, y = NULL, title = "Total"),
  # Specify the widths of the two columns and common legend position (bottom)
  widths = c(3, 1),
  common.legend = TRUE,
  legend = "bottom",
  labels = "auto")
```

### Hormonal variables

```{r hormone-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across hormonal variables, by condition. \\textbf{a.} Distribution of values for body temperature. Colored vertical lines indicate the mean value for participants in each condition. \\textbf{b.} Proportional number of participants across categorical variables.", fig.height = 4}
ggarrange(
  reg_fin |>
    select(ID, Condition, Body_temperature) |>
    pivot_longer(Body_temperature,
                 names_to = "Variable",
                 values_to = "Value") |>
    mutate(Value = as.numeric(Value)) |>
    ggplot(aes(x = Value, fill = Condition, color = Condition)) +
    geom_density(alpha = 0.3) +
    facet_wrap(~Variable) +
    stat_summary(aes(xintercept = after_stat(x), y = 0),
                 fun = mean, geom = "vline", orientation = "y") +
    labs(x = NULL, y = NULL),
  reg_fin |>
    left_join(desc_quest, by = c("ID", "Condition", "Hormonal_contraception")) |>
    select(ID, Condition, Ovulating, Hormonal_contraception) |>
    pivot_longer(Ovulating:Hormonal_contraception,
                 names_to = "Variable",
                 values_to = "Value") |>
    mutate(Variable = str_replace_all(Variable, "_", " ")) |>
    ggplot(aes(y = Value, fill = Condition, color = Condition)) +
    geom_bar(alpha = 0.3, position = position_dodge()) +
    geom_text(aes(label = scales::percent(after_stat(prop), accuracy = 0.1)),
              vjust = "inward",
              position = position_dodge(.9),
              stat = "prop",
              color = "black",
              size = 2.5) +
    facet_wrap(~Variable, scales = "free") +
    scale_y_discrete(labels = label_wrap(20)) +
    theme(axis.text.y = element_text(size = 8)) +
    labs(x = NULL, y = NULL),
  widths = c(1, 2),
  common.legend = TRUE,
  legend = "bottom",
  labels = "auto")
```

### Self-perceived conditions

```{r psych-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across self-perceived conditions. Colored vertical lines indicate the mean value for participants in each condition.", fig.height = 6}
desc_quest |>
  select(ID, Condition, starts_with("SP_"), -SP_health) |>
  pivot_longer(where(is.numeric),
               names_to = "Variable",
               values_to = "Value") |> 
  mutate(Variable = str_replace_all(Variable, "SP_", "")) |>
  mutate(Variable = str_replace_all(Variable, "self_", "self-")) |>
  mutate(Variable = str_replace_all(Variable, "_", " ")) |>
  mutate(Variable = str_to_sentence(Variable)) |> 
  ggplot(aes(x = Value, fill = Condition, color = Condition)) +
  geom_density(alpha = 0.3) +
  theme(legend.position = "bottom") +
  stat_summary(aes(xintercept = after_stat(x), y = 0),
               fun = mean, geom = "vline", orientation = "y") +
  labs(x = NULL, y = NULL) +
  facet_wrap(~Variable, scales = "free")
```

### Current/last partner perception

```{r partner-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across perceptions of the last partner by condition. Colored vertical lines indicate the mean value for participants in each condition.", fig.height = 4}
desc_quest |>
  select(ID, Condition, Partner_masculinity, Partner_dominance, 
         Partner_attractiveness) |>
  pivot_longer(where(is.numeric),
               names_to = "Variable",
               values_to = "Value") |> 
  mutate(Variable = str_replace_all(Variable, "Partner_", "")) |>
  mutate(Variable = str_to_sentence(Variable)) |> 
  ggplot(aes(x = Value, fill = Condition, color = Condition)) +
  geom_density(alpha = 0.3) +
  theme(legend.position = "bottom") +
  stat_summary(aes(xintercept = after_stat(x), y = 0),
               fun = mean, geom = "vline", orientation = "y") +
  labs(x = NULL, y = NULL) +
  facet_wrap(~Variable, scales = "free")
```

### Context violence

```{r context-violence-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across perceptions of violence, by condition. \\textbf{a.} Distribution of values across variables related to safety perception. \\textbf{b.} Perceptions of men as dangerous. \\textbf{c.} Proportional number of participants who reported being victims of the Colombian armed conflict. For panels a and b, colored vertical lines indicate the mean value for each variable under each condition. ", fig.height = 6}
ggarrange(desc_quest |>
            select(ID, Condition, ends_with("_safety"), Freq_robery) |>
            pivot_longer(where(is.numeric),
                         names_to = "Variable",
                         values_to = "Value") |> 
            mutate(Value = as.numeric(Value)) |> 
            mutate(Variable = str_replace_all(Variable, "_safety", "")) |>
            mutate(Variable = str_replace_all(Variable, "Perceived_", "")) |>
            mutate(Variable = str_replace_all(Variable, "Freq_", "Frequency of ")) |>
            mutate(Variable = str_replace_all(Variable, "Perceived", "General perception")) |>
            mutate(Variable = str_to_sentence(Variable)) |> 
            ggplot(aes(x = Value, fill = Condition, color = Condition)) +
            geom_density(alpha = 0.3) +
            labs(title = "Safety perception") +
            facet_wrap(~factor(Variable, c("Country", "City", "Neighborhood", "Home",
                                           "Frequency of robery", "General perception")),
                       scales = "free") +
            stat_summary(aes(xintercept = after_stat(x), y = 0),
                         fun = mean, geom = "vline", orientation = "y") +
            labs(x = NULL, y = NULL),
          ggarrange(desc_quest |>
                      select(ID, Condition, 
                             Men_perceived_as_dangerous) |> 
                      pivot_longer(Men_perceived_as_dangerous,
                                   names_to = "Variable",
                                   values_to = "Value") |> 
                      mutate(Variable = str_replace_all(Variable, 
                                                        "_", " ")) |> 
                      mutate(Variable = str_to_sentence(Variable)) |> 
                      ggplot(aes(x = Value, fill = Condition, color = Condition)) +
                      geom_density(alpha = 0.3) +
                      labs(title = "Men perceived as dangerous") +
                      facet_wrap(~Variable, scales = "free") +
                      stat_summary(aes(xintercept = after_stat(x), y = 0),
                                   fun = mean, geom = "vline", orientation = "y") +
                      theme(axis.text.y = element_text(size = 8)) +
                      labs(x = NULL, y = NULL),
                    desc_quest |>
                      select(ID, Condition, Victim_of_armed_conflict) |>
                      pivot_longer(Victim_of_armed_conflict,
                                   names_to = "Variable",
                                   values_to = "Value") |> 
                      mutate(Variable = str_replace_all(Variable, 
                                                        "_", " ")) |>
                      ggplot(aes(y = Value, fill = Condition, color = Condition)) +
                      geom_bar(alpha = 0.3, position = position_dodge()) +
                      geom_text(aes(label = scales::percent(after_stat(prop), accuracy = 0.1)),
                                vjust = "inward",
                                position = position_dodge(.9),
                                stat = "prop",
                                color = "black",
                                size = 2.5) +
                      labs(title = "Victim of armed conflict") +
                      facet_wrap(~Variable, scales = "free") +
                      scale_y_discrete(labels = label_wrap(20)) +
                      theme(axis.text.y = element_text(size = 8)) +
                      labs(x = NULL, y = NULL),
                    ncol = 1,
                    labels = c("", "c")),
          widths = c(2, 1),
          common.legend = TRUE,
          legend = "bottom",
          labels = "auto")
```

### Gender and partner violence

```{r gender-violence-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across gender and partner violence suffered by participants, by condition. \\textbf{a.} Distribution of values across numeric variables. Colored vertical lines indicate the mean value for each variable under each condition. \\textbf{b.} Proportional number of participants wacross categorical variables.", fig.height = 6}
ggarrange(desc_quest |>
            select(ID, Condition, Freq_partner_physical_violence,
                   , Freq_partner_sexual_violence, Freq_partner_infidelity) |>
            pivot_longer(where(is.numeric),
                         names_to = "Variable",
                         values_to = "Value") |> 
            mutate(Value = as.numeric(Value)) |> 
            mutate(Variable = str_replace_all(Variable, "Freq_partner_", "")) |>
            mutate(Variable = str_replace_all(Variable, "_", " ")) |>
            mutate(Variable = str_to_sentence(Variable)) |> 
            ggplot(aes(x = Value, fill = Condition, color = Condition)) +
            geom_density(alpha = 0.3) +
            facet_wrap(~factor(Variable, c("Physical violence",
                                           "Sexual violence",
                                           "Infidelity")), 
                       scales = "free", ncol = 1) +
            stat_summary(aes(xintercept = after_stat(x), y = 0),
                         fun = mean, geom = "vline", orientation = "y") +
            labs(x = NULL, y = NULL),
          desc_quest |> 
            select(ID, Condition, 
                   Victim_of_gender_violence, 
                   Partner_physical_violence,
                   Partner_sexual_violence,
                   Sexual_abuse) |> 
            pivot_longer(Victim_of_gender_violence:Sexual_abuse,
                         names_to = "Variable",
                         values_to = "Value") |> 
            mutate(Value = as.factor(Value)) |> 
            mutate(Variable = str_replace_all(Variable, 
                                              "_", " ")) |> 
            mutate(Variable = str_to_sentence(Variable)) |> 
            ggplot(aes(y = Value, fill = Condition, color = Condition)) +
            geom_bar(alpha = 0.3, position = position_dodge()) +
            geom_text(aes(label = scales::percent(after_stat(prop), accuracy = 0.1)),
                      vjust = "inward",
                      position = position_dodge(.9),
                      stat = "prop",
                      color = "black",
                      size = 2.5) +
            facet_wrap(~Variable, 
                       scales = "free") +
            scale_y_discrete(labels = label_wrap(20)) +
            theme(axis.text.y = element_text(size = 8)) +
            labs(x = NULL, y = NULL),
          widths = c(1, 3),
          common.legend = TRUE,
          legend = "bottom",
          labels = "auto")
```

### Subjective evaluation of stimuli

```{r stimuli-eval-desc-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Distribution of values across subjective evaluations of attractiveness and masculinity of the stimuli used in the experiment, split by sexual dimorphism manipulations (feminine, maculine). Panels on the left are for attractiveness scores, and on the right for masculinity scores. Top panels are for participants in the high condition, and on the bottom for the low condition. Colored vertical lines indicate the mean value for participants in each condition.", fig.height = 6}
eval_long |> 
  left_join(reg, by = c("ID")) |> 
  filter(ID %in% unique(dat$ID)) |> 
  rowwise() |> 
  mutate(Sexual_dimorphism = ifelse(grepl("F", Stimulus), "Feminine", "Masculine")) |> 
  select(Condition, Sexual_dimorphism, Attractiveness, Masculinity) |> 
  pivot_longer(Attractiveness:Masculinity,
               names_to = "Variable",
               values_to = "Value") |>
  ggplot(aes(x = Value, fill = Sexual_dimorphism, color = Sexual_dimorphism)) +
  geom_density(alpha = 0.3) +
  theme(legend.position = "bottom") +
  labs(y = "Density", x = "Score", color = "Sexual dimorphism", fill = "Sexual dimorphism") +
  facet_grid(Condition~Variable, scales = "free",
             labeller = labeller(Condition = cond_labs)) +
  scale_color_manual(values = c("#E69F00", "#56B4E9")) +
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  stat_summary(aes(xintercept = after_stat(x), y = 0),
               fun = mean, geom = "vline", orientation = "y")
```

## Correlations

### Correlations between partner violence and responses to masculinized and feminized stimuli

```{r}
dat_PCF <- dat |> 
  mutate(CF = as.numeric(recode(CF,
                                "Yes" =  "1",
                                "No" = "0"))) |> 
  group_by(ID, Sexual_dimorphism, Relationship, Condition) |> 
  summarise(CF = sum(CF)) |> 
  group_by(ID, Sexual_dimorphism, Relationship, Condition) |> 
  summarise(PCF = sum(CF)/30) |> 
  ungroup()

dat_short <- dat |> 
  group_by(ID, Relationship, Condition, Sexual_dimorphism) |> 
  summarise(Freq_partner_physical_violence = mean(Freq_partner_physical_violence),
            Freq_partner_sexual_violence = mean(Freq_partner_sexual_violence), 
            Freq_partner_infidelity = mean(Freq_partner_infidelity),
            Men_perceived_as_dangerous = mean(Men_perceived_as_dangerous),
            Perceived_home_safety = mean(Perceived_home_safety),
            DFF = mean(DFF),
            TFD = mean(TFD),
            NF = mean(NF),
            Attr = mean(Attractiveness),
            Masc = mean(Masculinity)) |> 
  left_join(dat_PCF |> 
              select(ID, Sexual_dimorphism, Relationship, Condition, PCF), 
            by = c("ID", "Sexual_dimorphism", "Relationship", "Condition")) |> 
  rename("PPV" = "Freq_partner_physical_violence",
         "PSV" = "Freq_partner_sexual_violence",      
         "PI" =  "Freq_partner_infidelity",
         "MPD" = "Men_perceived_as_dangerous",
         "PHS" = "Perceived_home_safety") |> 
  ungroup()

left_join(
  dat_short |>
    filter(Relationship == "Short term" &
             Condition == "Low" & 
             Sexual_dimorphism == "Masculinized") |>
    select(where(is.numeric)) |> 
    corr.stars() |>
    rownames_to_column(var = "Effect") |> 
    dplyr::slice(-1),
  dat_short |>
    filter(Relationship == "Short term" &
             Condition == "Low" & 
             Sexual_dimorphism == "Feminized") |>
    select(where(is.numeric)) |> 
    corr.stars() |>
    rownames_to_column(var = "Effect") |> 
    dplyr::slice(-1),
  by = "Effect") |> 
  bind_rows(left_join(
    dat_short |>
      filter(Relationship == "Long term" &
               Condition == "Low" & 
               Sexual_dimorphism == "Masculinized") |>
      select(where(is.numeric)) |> 
      corr.stars() |>
      rownames_to_column(var = "Effect") |> 
      dplyr::slice(-1),
    dat_short |>
      filter(Relationship == "Long term" &
               Condition == "Low" & 
               Sexual_dimorphism == "Feminized") |>
      select(where(is.numeric)) |> 
      corr.stars() |>
      rownames_to_column(var = "Effect") |> 
      dplyr::slice(-1),
    by = "Effect")) |> 
  bind_rows(left_join(
    dat_short |>
      filter(Relationship == "Short term" &
               Condition == "High" & 
               Sexual_dimorphism == "Masculinized") |>
      select(where(is.numeric)) |> 
      corr.stars() |>
      rownames_to_column(var = "Effect") |> 
      dplyr::slice(-1),
    dat_short |>
      filter(Relationship == "Short term" &
               Condition == "High" & 
               Sexual_dimorphism == "Feminized") |>
      select(where(is.numeric)) |> 
      corr.stars() |>
      rownames_to_column(var = "Effect") |> 
      dplyr::slice(-1),
    by = "Effect")) |>
  bind_rows(left_join(
    dat_short |>
      filter(Relationship == "Long term" &
               Condition == "High" & 
               Sexual_dimorphism == "Masculinized") |>
      select(where(is.numeric)) |> 
      corr.stars() |>
      rownames_to_column(var = "Effect") |> 
      dplyr::slice(-1),
    dat_short |>
      filter(Relationship == "Long term" &
               Condition == "High" & 
               Sexual_dimorphism == "Feminized") |>
      select(where(is.numeric)) |> 
      corr.stars() |>
      rownames_to_column(var = "Effect") |> 
      dplyr::slice(-1),
    by = "Effect")) |> 
  kable(digits = 2,
        booktabs = TRUE,
        align = c("l", rep("c", 20)),
        linesep = "",
        col.names = c("Effect",
                      rep(c("PPV", "PSV", "PI", "MPD", "PHS", "DFF", 
                            "TFD", "NF", "Attr.", "Masc."), times = 2)),
        caption = "Correlations between partner violence and responses to masculinized and 
        feminized stimuli",
        escape = FALSE) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |> 
  add_header_above(c(" ",
                     "Masculinized" = 10, 
                     "Feminized" = 10),
                   bold = TRUE) |> 
  pack_rows("Low condition, short-term relationship", 1, 10,
            hline_after = TRUE) |> 
  pack_rows("Low condition, long-term relationship", 11, 20,
            hline_after = TRUE, hline_before = TRUE) |>
  pack_rows("High condition, short-term relationship", 21, 30,
            hline_after = TRUE, hline_before = TRUE) |> 
  pack_rows("High condition, long-term relationship", 31, 40,
            hline_after = TRUE, hline_before = TRUE) |> 
  footnote(general = paste0("Values represent Pearson correlation coefficients ($r$). ",
                            "PPV = Frequency of partner physical violence; 
                            PSV = Frequency of partner sexual violence;
                            PI =  Frequency of partner infidelity; 
                            MPD = Men perceived as dangerous;
                            PHS = Perceived home safety;
                            DFF = Duration of First Fixation; 
                            TDF = Total Fixation Duration; 
                            NF = Number of Fixations; 
                            Attr. = attractiveness; 
                            Masc. = masculinity;
                            PCF = proportion of Chosen Faces. ", 
                            "For significance, $^{\\\\dagger}p$ < 0.1, *$p$ < 0.05, ",
                            "**$p$ < 0.01, ***$p$ < 0.001. ",
                            "Significant correlations are in bold."),
           threeparttable = TRUE,
           footnote_as_chunk = TRUE,
           escape = FALSE)
```

# Manipulation check

## Resource availability dimensions by condition

```{r}
reg_fin |> 
  select(starts_with("Condition")) |> 
  pivot_longer(cols = contains("_"),
               names_to = "Dimension",
               values_to = "Score") |> 
  group_by(Dimension) |> 
  summarise("Mean (Low)" = mean(Score[reg_fin$Condition == "Low"]),
            "Mean (High)" = mean(Score[reg_fin$Condition == "High"]),
            "$t$" = t.test(Score ~ Condition)$statistic,
            "$p$" = t.test(Score ~ Condition)$p.value,
            "$g$" = hedges_g(Score ~ Condition)$Hedges_g) |> 
  ungroup() |> 
  mutate(Dimension = str_replace_all(Dimension, "_", " "),
         Dimension = str_remove_all(Dimension, "Condition "),
         Dimension = str_to_title(Dimension)) |> 
  mutate("$p$" = pval.lev("$p$")) |> 
  kable(digits = 2,
        booktabs = TRUE,
        align = c("l", rep("c", 5)),
        linesep = "",
        caption = "Mean scores and comparison of resource availability dimensions by condition",
        escape = FALSE) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  add_header_above(c(" ",
                     "Condition" = 2,
                     " " = 3),
                   bold = TRUE) |> 
  footnote(general = "Results are from Welch's \\\\textit{t}-test. 
           As effect size, Hedges' \\\\textit{g} values are reported.",
           threeparttable = TRUE,
           footnote_as_chunk = TRUE,
           escape = FALSE)
```

## Effect of sexual dimorphisim manipulation on masculinity and attractiveness ratings, by condition

```{r sex-dimor-check-plot, message = FALSE, warning = FALSE, results = "hold", fig.cap = "Effect of sexual dimorphisim manipulation on ratings of \\textbf{(a)} masculinity and \\textbf{(b)} attractiveness, by condition (High, Low). Reported significance are contrasts between sexual dimorphisim levels (feminized, masculinized) from linear mixed models including the fixed effects of condition, sexual dimorphism, and their interaction, as well as random intercepts per participants. In both models the main (within-subject) effect of the sexual dimorphism manipulation was significant, but not the main effect of condition or its interaction with sexual dimorphism. Mean ratings and 95% CIs are in black. ***\\textit{p} < 0.001.", fig.height = 4}
# Clean data fro models
eval_desc <- dat |>
  group_by(ID, Sexual_dimorphism, Condition) |> 
  summarise(Masculinity = mean(Masculinity),
            Attractiveness = mean(Attractiveness))

# Masculinity
mod_masc <- lmer(Masculinity ~ Sexual_dimorphism * Condition + (1 | ID), data = eval_desc)
# anova(mod_masc)
contr_mod_masc <- as.data.frame(pairs(emmeans(mod_masc,
                                              ~ Sexual_dimorphism | Condition))) |> 
  separate(contrast, c("group1", "group2"), " - ") |> 
  mutate(p.signif = stars.pval(p.value))

p_mancheck_masc <- ggplot(eval_desc, aes(x = Sexual_dimorphism, 
                                         y = Masculinity, 
                                         color = Sexual_dimorphism)) +
  geom_jitter(alpha = 0.5) +
  stat_summary(fun.data = "mean_cl_boot",
               color = "black", 
               size = 0.3) +
  stat_summary(fun.y = mean, 
               colour = "black", 
               geom = "line", 
               aes(group = 1)) +
  stat_pvalue_manual(contr_mod_masc, label = "p.signif",
                     y.position = 10.5,
                     hide.ns = TRUE,
                     tip.length = 0) +
  labs(x = NULL,
       color = "Sexual dimorphism") +
  facet_wrap(~Condition,
             labeller = labeller(Condition = cond_labs))

# Attractiveness
mod_attr <- lmer(Attractiveness ~ Sexual_dimorphism * Condition + (1 | ID), data = eval_desc)
# anova(mod_attr)
contr_mod_attr <- as.data.frame(pairs(emmeans(mod_attr,
                                              ~ Sexual_dimorphism | Condition))) |> 
  separate(contrast, c("group1", "group2"), " - ") |> 
  mutate(p.signif = stars.pval(p.value))

p_mancheck_attr <- ggplot(eval_desc, aes(x = Sexual_dimorphism, 
                                         y = Attractiveness, 
                                         color = Sexual_dimorphism)) +
  geom_jitter(alpha = 0.5) +
  stat_summary(fun.data = "mean_cl_boot",
               color = "black",
               size = 0.3) +
  stat_summary(fun.y = mean, colour = "black", geom = "line", aes(group = 1)) +
  stat_pvalue_manual(contr_mod_attr, label = "p.signif",
                     y.position = 10,
                     hide.ns = TRUE,
                     tip.length = 0) +
  labs(x = NULL,
       color = "Sexual dimorphism") +
  facet_wrap(~Condition,
             labeller = labeller(Condition = cond_labs))

# Combined plot
ggarrange(p_mancheck_masc, p_mancheck_attr,
          legend = "none",
          labels = "auto")  |> 
  annotate_figure(bottom = text_grob("Sexual dimorphism",
                                     size = 11))
```

# Models of the experimental design {#experiment-models}

We modeled the experimental design, by fitting linear models with the main effects and all possible interactions between Sexual dimorphism (masculinized, feminized), Relationship (short term, long term), and Condition (low, high). Separate models were fitted for each dependent variable: Duration of First Fixations (DFF), Total Fixation Duration (TFD), Number of Fixations (NF), and Proportion of Chosen Faces (PCF). 

For models of fixations (DFF, TFD, and NF) we included random intercepts and random slopes for each participant between sexual dimorphism levels, as well as random intercepts for each stimulus (i.e. these were linear mixed models), in line with recommendations [@barrRandomEffectsStructure2013]. However, to test the Proportion of Chosen Faces (PCF), we used a linear model without random effects, as there was only one value per participant (a proportion) for each combination of factors.

As effect sizes, for linear mixed models we report Nakagawa's conditional and marginal $R^2$ values [@nakagawaGeneralSimpleMethod2013], but we do not report standardized effect sizes for individual terms, as there is no accepted method to do so. 

For the linear model of Proportion of Chosen Faces (PCF), we report both unadjusted and adjusted $R^2$ as full model effect sizes, but also include $\omega^2_p$ scores as standardized effect sizes for each term. As frequently reported, $\omega^2$ is a more reliable measure of effect size than the more commonly used $\eta^2$ [e.g., @kroesDemystifyingOmegaSquared2023].

## Duration of First Fixations (DFF)

### Data

```{r}
dat_m1 <- dat |> 
  select(DFF, Condition, Relationship, Sexual_dimorphism,
         ID, Stimulus,
         Freq_partner_physical_violence, Freq_partner_sexual_violence,
         Freq_partner_infidelity, Men_perceived_as_dangerous,
         Perceived_home_safety) |> 
  filter(DFF >= 100 & DFF <= 1000) |> 
  drop_na()
```

### Fit linear mixed model

```{r}
mod1 <- lmer(DFF ~ Condition * Relationship * Sexual_dimorphism +
               (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
             data = dat_m1)
```

#### Model assumptions

Model assumptions were checked using the `check_model` function from the `performance` package [@ludecke2021].

```{r assu-mod1, cache = TRUE, message = FALSE, fig.height = 11, fig.cap = "Model assumptions. Plots represent prediction check, linearity, homogeneity of variance, influential observations, collinearity, and normality of both residuals and random effects, respectively."}
check_model(mod1)
```

### Table of fixed effects

```{r tab-mod1}
tab_m1 <- lmer.anova.tab(model = mod1)
tab_m1$kab
```

### Estimated marginal means and *post-hoc* contrasts of significant effects

#### Main effect: Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli. 

```{r}
main.eff.contr(model = mod1,
               emm_contr = emmeans(mod1, pairwise ~ Sexual_dimorphism))
```

### Full design contrasts

Table of estimated marginal means and contrasts between masculinized and feminized stimuli including the full experimental design. 

```{r tab-contr-mod1}
full.contr(model = mod1,
           emm_contr = emmeans(mod1, pairwise ~ Sexual_dimorphism | Relationship + Condition))
```

### Figure for the DFF model

This figure summarizes the the DFF model results.

```{r fig-mod1, results = "hold", fig.cap = "Differences in the Duration of First Fixations (DFF) to masculinized and feminized stimuli, by relationship (short term, ling term) and condition (low, high). Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:tab-mod1) and \\@ref(tab:tab-contr-mod1)). In all cases, significant effects are represented with lines and stars: \\**p* < 0.05.", warning = FALSE, message = FALSE, fig.height = 5}
pm1 <- plot.exp(model = mod1, 
                y.pos = c(266, NA, NA, 268),
                y.lab = "Duration of First Fixation (DFF)")
pm1
```

## Total Fixation Duration (TFD)

### Data

```{r}
dat_m2 <- dat |> 
  select(TFD, Condition, Relationship, Sexual_dimorphism,
         ID, Stimulus,
         Freq_partner_physical_violence, Freq_partner_sexual_violence,
         Freq_partner_infidelity, Men_perceived_as_dangerous,
         Perceived_home_safety) |> 
  filter(TFD >= 100 & TFD <= 1000) |> 
  drop_na()
```

### Fit linear mixed model

```{r}
mod2 <- lmer(TFD ~ Condition * Relationship * Sexual_dimorphism +
               (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
             data = dat_m2,
             control = lmerControl(optimizer="bobyqa"))
```

#### Model assumptions

Model assumptions were checked using the `check_model` function from the `performance` package [@ludecke2021].

```{r assu-mod2, cache = TRUE, message = FALSE, fig.height = 11, fig.cap = "Model assumptions. Plots represent prediction check, linearity, homogeneity of variance, influential observations, collinearity, and normality of both residuals and random effects, respectively."}
check_model(mod2)
```

### Table of fixed effects

```{r tab-mod2}
tab_m2 <- lmer.anova.tab(model = mod2)
tab_m2$kab
```

### Estimated marginal means and *post-hoc* contrasts of significant effects

#### Main effect: Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli. 

```{r}
main.eff.contr(model = mod2,
               emm_contr = emmeans(mod2, pairwise ~ Sexual_dimorphism))
```

#### Interaction: Relationship × Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli by relationship. 

```{r}
inter.contr(model = mod2,
            emm_contr = emmeans(mod2, pairwise ~ Sexual_dimorphism | Relationship))
```

### Full design contrasts

Table of estimated marginal means and contrasts between masculinized and feminized stimuli including the full experimental design. 

```{r tab-contr-mod2}
full.contr(model = mod2,
           emm_contr = emmeans(mod2, pairwise ~ Sexual_dimorphism | Relationship + Condition))
```

### Figure for the TFD model

This figure summarizes the the TFD model results.

```{r fig-mod2, results = "hold", fig.cap = "Differences in the Total Fixation Duration (TFD) to masculinized and feminized stimuli, by relationship (short term, ling term) and condition (low, high). Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:tab-mod2) and \\@ref(tab:tab-contr-mod2)). In all cases, significant effects are represented with lines and stars: \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001", warning = FALSE, message = FALSE, fig.height = 5}
pm2 <- plot.exp(model = mod2, 
                y.pos = c(700, 700, 705, 705),
                y.lab = "Total Fixation Duration (TFD)")
pm2
```

## Number of Fixations (NF)

### Data

```{r}
dat_m3 <- dat |> 
  select(NF, Condition, Relationship, Sexual_dimorphism,
         ID, Stimulus, 
         Freq_partner_physical_violence, Freq_partner_sexual_violence,
         Freq_partner_infidelity, Men_perceived_as_dangerous,
         Perceived_home_safety) |> 
  group_by(ID, Stimulus, Relationship) |> 
  filter(!(sum(NF[Sexual_dimorphism == "Masculinized"] == 0) > 0 & 
             sum(NF[Sexual_dimorphism == "Feminized"] == 0) > 0)) |>
  ungroup() |> 
  drop_na()
```

### Fit linear mixed model

```{r}
mod3 <- glmer(NF ~ Condition * Relationship * Sexual_dimorphism +
               (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
             data = dat_m3,
             family = poisson)
```

#### Model assumptions

Model assumptions were checked using the `check_model` function from the `performance` package [@ludecke2021].

```{r assu-mod3, cache = TRUE, message = FALSE, fig.height = 8, fig.cap = "Model assumptions. Plots represent prediction check, homogeneity of variance, influential observations, collinearity, and normality of random effects, respectively."}
check_model(mod3, check = c("pp_check", "homogeneity", "outliers", "vif", "reqq"))
```

### Table of fixed effects

```{r tab-mod3}
tab_m3 <- glmer.anova.tab(model = mod3)
tab_m3$kab
```

### Estimated marginal means and *post-hoc* contrasts of significant effects

#### Main effect: Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli. 

```{r}
main.eff.contr(model = mod3,
               emm_contr = emmeans(mod3, pairwise ~ Sexual_dimorphism))
```

#### Interaction: Relationship × Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli by relationship. 

```{r}
inter.contr(model = mod3,
            emm_contr = emmeans(mod3, pairwise ~ Sexual_dimorphism | Relationship))
```

### Full design contrasts

Table of estimated marginal means and contrasts between masculinized and feminized stimuli including the full experimental design. 

```{r tab-contr-mod3}
full.contr(model = mod3,
           emm_contr = emmeans(mod3, pairwise ~ Sexual_dimorphism | Relationship + Condition))
```

### Figure for the NF model

This figure summarizes the the NF model results.

```{r fig-mod3, results = "hold", fig.cap = "Differences in the Number of Fixations (NF) to masculinized and feminized stimuli, by relationship (short term, ling term) and condition (low, high). Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:tab-mod3) and \\@ref(tab:tab-contr-mod3)). In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001.", warning = FALSE, message = FALSE, fig.height = 5}
pm3 <- plot.exp(model = mod3, 
                y.pos = c(1.3, 1.3, 1.31, 1.31),
                y.lab = "Number of Fixations (NF)")
pm3
```

## Proportion of Chosen Faces (PCF)

### Data

```{r}
dat_m4  <- dat |> 
  mutate(CF = as.numeric(recode(CF,
                                "Yes" =  "1",
                                "No" = "0"))) |> 
  group_by(ID, Stimulus, Relationship) |> 
  filter(!(sum(CF[Sexual_dimorphism == "Masculinized"] == 0) > 0 & 
             sum(CF[Sexual_dimorphism == "Feminized"] == 0) > 0)) |>
  ungroup() |> 
  group_by(ID, Sexual_dimorphism, Relationship, Condition,
           Freq_partner_physical_violence,
           Freq_partner_sexual_violence,
           Freq_partner_infidelity,
           Men_perceived_as_dangerous,
           Perceived_home_safety) |> 
  summarise(CF = sum(CF)) |> 
  ungroup() |> 
  mutate(PCF = CF/30) |> 
  drop_na()
```

### Fit linear mixed model

```{r}
mod4 <- lm(PCF ~ Condition * Relationship * Sexual_dimorphism,
           data = dat_m4)
```

#### Model assumptions

Model assumptions were checked using the `check_model` function from the `performance` package [@ludecke2021].

```{r assu-mod4, cache = TRUE, message = FALSE, fig.height = 11, fig.cap = "Model assumptions. Plots represent prediction check, linearity, homogeneity of variance, influential observations, collinearity, and normality of residuals, respectively."}
check_model(mod4)
```

### Table of fixed effects

```{r tab-mod4}
tab_m4 <- lm.anova.tab(model = mod4)
tab_m4$kab
```

### Estimated marginal means and *post-hoc* contrasts of significant effects

#### Main effect: Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r}
main.eff.contr(model = mod4,
               emm_contr = emmeans(mod4, pairwise ~ Sexual_dimorphism))
```

#### Interaction: Relationship × Sexual dimorphism

Table of estimated marginal means and contrasts between masculinized and feminized stimuli by relationship. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r}
inter.contr(model = mod4,
            emm_contr = emmeans(mod4, pairwise ~ Sexual_dimorphism | Relationship))
```


### Full design contrasts

Table of estimated marginal means and contrasts between masculinized and feminized stimuli including the full experimental design. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-contr-mod4}
full.contr(model = mod4,
           emm_contr = emmeans(mod4, pairwise ~ Sexual_dimorphism | Relationship + Condition))
```

### Figure for the NF model

This figure summarizes the the PCF model results.

```{r fig-mod4, results = "hold", fig.cap = "Differences in the proportion of masculinized and feminized chosen faces (PCF), by relationship (short term, ling term) and condition (low, high). Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:tab-mod4) and \\@ref(tab:tab-contr-mod4)). In all cases, significant effects are represented with lines and stars: \\*\\*\\**p* < 0.001.", warning = FALSE, message = FALSE, fig.height = 5}
pm4 <- plot.exp(model = mod4, 
                y.pos = c(0.75, 0.77, 0.78, 0.8),
                y.lab = "Proportion of Chosen Faces (PCF)")
pm4
```

# Exploring interactions with covariates

In each case (i.e. for each dependent variable), we fitted five competing models, each one interacting with a different numeric variable related to the frequency of the current/last partner violent behaviors of perceived safety:

* Perception of men as dangerous
* Intimate partner sexual violence 
* Intimate partner physical violence
* Partner infidelity
* Perceived home safety

Then, the model without covariates (fitted in section \@ref(experiment-models)) and these five models with a covariate were compared using AIC scores [@akaikeInformationTheoryExtension1998; @akaikeNewLookStatistical1974], and Akaike weights [see e.g., @wagenmakersAICModelSelection2004; @portetPrimerModelSelection2020] to measure the relative probability of each compared model of being the *best* model within that set of compared models, for the collected data.

## Duration of First Fixations (DFF)

### Fit linear models with interactions partner violence variables

```{r}
# Model a: interaction with Men Perceived as Dangerous
mod1a <- lmer(DFF ~
                Condition * Relationship * Sexual_dimorphism * Men_perceived_as_dangerous +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m1)

# Model b: interaction with Frequency of Intimate Partner Physical Violence
mod1b <- lmer(DFF ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_physical_violence +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m1)

# Model c: interaction with Frequency of Intimate Partner Sexual Violence
mod1c <- lmer(DFF ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_sexual_violence +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m1)

# Model d: interaction with Frequency of Partner Infidelity
mod1d <- lmer(DFF ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_infidelity +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m1)

# Model e: interaction with Perceived Home Safety
mod1e <- lmer(DFF ~
                Condition * Relationship * Sexual_dimorphism * Perceived_home_safety +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m1)
```

### Model comparison

```{r comp-m1}
comp_m1_cov <- mods.comp(base.model = "mod1")
comp_m1_cov$kab
```

### Best model

#### Table of fixed effects

```{r tab-best-mod1}
best_m1_cov <- eval(parse(text = rownames(data.frame(comp_m1_cov$comp))[1]))
tab_m1_cov <- lmer.anova.tab(model = best_m1_cov)
tab_m1_cov$kab
```

#### Figure for the best model predicting DFF

```{r fig-mod1-cov, results = "hold", fig.cap = "Differences in the Duration of First Fixations (DFF) to masculinized and feminized stimuli, by relationship (short term, ling term), condition (low, high), and the frequency of partner physycal violence, which was the covariate included in the best-supported model. To illustrate the effect of the physycal violence interaction, estimated marginal means are shown at minimum and maximum levels of this covariate. Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:comp-m1) and \\@ref(tab:tab-best-mod1)). In all cases, significant effects are represented with lines and stars: \\**p* < 0.05.", warning = FALSE, message = FALSE}
pm1f <- plot.best.mod(best_model = best_m1_cov, 
                      y.pos = c(300, NA, 280, 300,NA, NA, 300, NA),
                      y.lab = "Duration of First Fixation (DFF)")
pm1f
```

## Total Fixation Duration (TFD)

### Fit linear models with interactions partner violence variables

```{r}
# Model a: interaction with Men Perceived as Dangerous
mod2a <- lmer(TFD ~
                Condition * Relationship * Sexual_dimorphism * Men_perceived_as_dangerous +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m2)

# Model b: interaction with Frequency of Intimate Partner Physical Violence
mod2b <- lmer(TFD ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_physical_violence +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m2)

# Model c: interaction with Frequency of Intimate Partner Sexual Violence
mod2c <- lmer(TFD ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_sexual_violence +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m2)

# Model d: interaction with Frequency of Partner Infidelity
mod2d <- lmer(TFD ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_infidelity +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m2)

# Model e: interaction with Perceived Home Safety
mod2e <- lmer(TFD ~
                Condition * Relationship * Sexual_dimorphism * Perceived_home_safety +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m2)
```

### Model comparison

```{r comp-m2}
comp_m2_cov <- mods.comp(base.model = "mod2")
comp_m2_cov$kab
```

### Best model

#### Table of fixed effects

```{r tab-best-mod2}
best_m2_cov <- eval(parse(text = rownames(data.frame(comp_m2_cov$comp))[1]))
tab_m2_cov <- lmer.anova.tab(model = best_m2_cov)
tab_m2_cov$kab
```

#### Figure for the best model predicting TFD

```{r fig-mod2-cov, results = "hold", fig.cap = "Differences in the Total Fixation Duration (TFD) to masculinized and feminized stimuli, by relationship (short term, ling term), condition (low, high), and the frequency of partner physycal violence, which was the covariate included in the best-supported model. To illustrate the effect of the physycal violence interaction, estimated marginal means are shown at minimum and maximum levels of this covariate. Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:comp-m2) and \\@ref(tab:tab-best-mod2)). In all cases, significant effects are represented with lines and stars: \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001.", warning = FALSE, message = FALSE}
pm2f <- plot.best.mod(best_model = best_m2_cov, 
                      y.pos = c(800, 800, 850, 850, NA, NA, 850, NA),
                      y.lab = "Total Fixation Duration (TFD)")
pm2f
```

## Number of Fixations (NF)

### Fit linear models with interactions partner violence variables

```{r cache = TRUE, warning = FALSE, message = FALSE}
# Model a: interaction with Men Perceived as Dangerous
mod3a <- glmer(NF ~
                Condition * Relationship * Sexual_dimorphism * Men_perceived_as_dangerous +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m3,
              family = poisson)

# Model b: interaction with Frequency of Intimate Partner Physical Violence
mod3b <- glmer(NF ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_physical_violence +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m3,
              family = poisson)

# Model c: interaction with Frequency of Intimate Partner Sexual Violence
mod3c <- glmer(NF ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_sexual_violence +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m3,
              family = poisson)

# Model d: interaction with Frequency of Partner Infidelity
mod3d <- glmer(NF ~
                Condition * Relationship * Sexual_dimorphism * Freq_partner_infidelity +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m3,
              family = poisson)

# Model e: interaction with Perceived Home Safety
mod3e <- glmer(NF ~
                Condition * Relationship * Sexual_dimorphism * Perceived_home_safety +
                (1 + Sexual_dimorphism | ID) + (1 | Stimulus), 
              data = dat_m3,
              family = poisson)
```

### Model comparison

```{r comp-m3}
comp_m3_cov <- mods.comp(base.model = "mod3")
comp_m3_cov$kab
```

### Best model

#### Table of fixed effects

```{r tab-best-mod3}
best_m3_cov <- eval(parse(text = rownames(data.frame(comp_m3_cov$comp))[1]))
tab_m3_cov <- glmer.anova.tab(model = best_m3_cov)
tab_m3_cov$kab
```

#### Figure for the best model predicting NF

```{r fig-mod3-cov, results = "hold", fig.cap = "Differences in the Number of Fixations (NF) to masculinized and feminized stimuli, by relationship (short term, ling term), condition (low, high). In this case, the best model was the model without covatiates. Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:comp-m3) and \\@ref(tab:tab-best-mod3)). In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001.", warning = FALSE, message = FALSE}
pm3f <- plot.best.mod(best_model = best_m3_cov, 
                      y.pos = c(1.35, 1.35, 1.45, 1.45, NA, NA, 1.9, NA),
                      y.lab = "Number of Fixations (NF)")
pm3f
```

## Proportion of Chosen Faces (PCF)

### Fit linear models with interactions partner violence variables

```{r}
# Model a: interaction with Men Perceived as Dangerous
mod4a <- lm(PCF ~
              Condition * Relationship * Sexual_dimorphism * Men_perceived_as_dangerous,
            data = dat_m4)

# Model b: interaction with Frequency of Intimate Partner Physical Violence
mod4b <- lm(PCF ~
              Condition * Relationship * Sexual_dimorphism * Freq_partner_physical_violence,
            data = dat_m4)

# Model c: interaction with Frequency of Intimate Partner Sexual Violence
mod4c <- lm(PCF ~
              Condition * Relationship * Sexual_dimorphism * Freq_partner_sexual_violence,
            data = dat_m4)

# Model d: interaction with Frequency of Partner Infidelity
mod4d <- lm(PCF ~
              Condition * Relationship * Sexual_dimorphism * Freq_partner_infidelity,
            data = dat_m4)

# Model e: interaction with Perceived Home Safety
mod4e <- lm(PCF ~
              Condition * Relationship * Sexual_dimorphism * Perceived_home_safety,
            data = dat_m4)
```

### Model comparison

```{r comp-m4}
comp_m4_cov <- mods.comp(base.model = "mod4")
comp_m4_cov$kab
```

### Best model

#### Table of fixed effects

```{r tab-best-mod4}
best_m4_cov <- eval(parse(text = rownames(data.frame(comp_m4_cov$comp))[1]))
tab_m4_cov <- lm.anova.tab(model = best_m4_cov)
tab_m4_cov$kab
```

#### Figure for the best model predicting PCF

```{r fig-mod4-cov, results = "hold", fig.cap = "Differences in the Proportion of Chosen Faces (PCF) to masculinized and feminized stimuli, by relationship (short term, ling term), condition (low, high), and the frequency of partner physycal violence, which was the covariate included in the best-supported model. To illustrate the effect of the physycal violence interaction, estimated marginal means are shown at minimum and maximum levels of this covariate. Dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:comp-m4) and \\@ref(tab:tab-best-mod4)). In all cases, significant effects are represented with lines and stars: \\**p* < 0.05.", warning = FALSE, message = FALSE}
pm4f <- plot.best.mod(best_model = best_m4_cov, 
                      y.pos = c(0.8, 0.8, 0.95, 0.95, NA, 1, 0.95, NA),
                      y.lab = "Proportion of Chosen Faces (PCF)")
pm4f
```

# Final figures and tables (included in the main paper)

```{=latex}
\closesupplement
```

## Figure with example of sexual dimorphism manipulation

```{r results = "hold", fig.cap = "Example of sexual dimorphism manipulation.", warning = FALSE, message = FALSE}
fig1a <- ggplot() +
  background_image(image_read("Images/01M.jpg")) +
  labs(title = "Masculinized") +
  theme(plot.margin = margin(t = 0.2, l = 1, r = 0, b = 0, unit = "cm"))

fig1b <- ggplot() +
  background_image(image_read("Images/01F.jpg")) +
  labs(title = "Feminized") +
  theme(plot.margin = margin(t = 0.2, l = 1, r = 0, b = 0, unit = "cm"))

ggarrange(fig1a, fig1b)
```

## Table of fixed effects for experimental design models

```{r}
tab_m1$tab |> 
  left_join(tab_m2$tab, by = "Fixed effect") |> 
  left_join(tab_m3$tab, by = "Fixed effect") |> 
  left_join(tab_m4$tab, by = "Fixed effect") |>
  slice_head(n = 7) |> 
  kable(digits = 2,
        booktabs = TRUE,
        align = c("l", rep("c", 13)),
        col.names = c("Fixed effect",
                      "$F$", "$df$", "$p$",
                      "$F$", "$df$", "$p$",
                      "$\\chi^2$", "$df$", "$p$",
                      "$F$", "$df$", "$p$", "$\\omega^2_p$"),
        linesep = "",
        caption = "Pattern of gaze and choice of face by resource availability condition, 
        relationship context and sexual dimorphism ",
        escape = FALSE) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  add_header_above(c(" " = 1,
                     "Duration of First Fixations (DFF)" = 3,
                     "Total Fixation Duration (TFD)" = 3,
                     "Number of Fixations (NF)" = 3,
                     "Proportion of Chosen Faces (PCF)" = 4)) |> 
  footnote(general = "For models predicting fixation measurements (DFF, TFD, and NF) results 
  are from linear mixed models (general, in the case of DFF, TFD, generalized with a poisson
  distributuion in the case of NF); for PCF, results are from a linear model without 
  random effects, and $\\\\omega^2_p$ effect sizes are reported for each term. For further 
  details, including full model effect sizes (Nakagawa's conditional and marginal $R^2$ for 
  linear mixed models, and unadjusted and adjusted $R^2$ for the PCF linear model), 
  see tables \\@ref(tab:tab-mod1), \\@ref(tab:tab-mod2), \\@ref(tab:tab-mod3) and 
  \\@ref(tab:tab-mod4) in the Supplementary Material. Significant effects are in bold.",
  threeparttable = TRUE, 
  footnote_as_chunk = TRUE, 
  escape = FALSE)
```

## Figure of experimental design models

```{r results = "hold", fig.cap = "Differences in responses to masculinized and feminized stimuli, by relationship (short term, ling term), condition (low, high), and the frequency of partner physycal violence, which was the covariate included in all best-supported models. To illustrate the effect of the physycal violence interaction, estimated marginal means are shown at minimum and maximum levels of this covariate. \\textbf{a.} Duration of First Fixations (DFF). \\textbf{b.} Total Fixation Duration (TFD). \\textbf{c.} Number of Fixations (NF). \\textbf{d.} Proportion of Chosen Faces (PCF). Black dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:tab-mod1) to \\@ref(tab:tab-contr-mod4) in the Supplementary Material. In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001.", warning = FALSE, message = FALSE}
ggarrange(pm1, pm2,pm3, pm4,
          common.legend = TRUE,
          legend = "bottom",
          labels = "auto")
```

## Table of fixed effects for best-supported models

```{r}
tab_m1_cov$tab |> 
  left_join(tab_m2_cov$tab, by = "Fixed effect") |> 
  left_join(tab_m3_cov$tab, by = "Fixed effect") |> 
  left_join(tab_m4_cov$tab, by = "Fixed effect") |> 
  slice_head(n = 15) |> 
  kable(digits = 2,
        booktabs = TRUE,
        align = c("l", rep("c", 13)),
        col.names = c("Fixed effect",
                      "$F$", "$df$", "$p$",
                      "$F$", "$df$", "$p$",
                      "$\\chi^2$", "$df$", "$p$",
                      "$F$", "$df$", "$p$", "$\\omega^2_p$"),
        linesep = "",
        caption = "Best-supported models predicting pattern of gaze and choice",
        escape = FALSE) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  add_header_above(c(" " = 1,
                     "Duration of First Fixations (DFF)" = 3,
                     "Total Fixation Duration (TFD)" = 3,
                     "Number of Fixations (NF)" = 3,
                     "Proportion of Chosen Faces (PCF)" = 4)) |> 
  footnote(general = "Best-supported model for predicting each dependen variable. 
  For models predicting fixation measurements (DFF, TFD, and NF) results 
  are from linear mixed models (general, in the case of DFF, TFD, generalized with a poisson
  distributuion in the case of NF); for PCF, results are from a linear model without 
  random effects, and $\\\\omega^2_p$ effect sizes are reported for each term. For further 
  details, including full model effect sizes (Nakagawa's conditional and marginal $R^2$ for 
  linear mixed models, and unadjusted and adjusted $R^2$ for the PCF linear model), 
  see tables \\@ref(tab:comp-m1), \\@ref(tab:tab-best-mod2), \\@ref(tab:tab-best-mod3) 
  and \\@ref(tab:tab-best-mod4) in the Supplementary Material. 
  Significant effects are in bold.",
  threeparttable = TRUE, 
  footnote_as_chunk = TRUE, 
  escape = FALSE)
```

## Figure of experimental design models

```{r results = "hold", fig.cap = "Differences in responses to masculinized and feminized stimuli, by relationship (short term, ling term) and condition (low, high). \\textbf{a.} Duration of First Fixations (DFF). \\textbf{b.} Total Fixation Duration (TFD). \\textbf{c.} Number of Fixations (NF). \\textbf{d.} Proportion of Chosen Faces (PCF). Black dots and bars represent estimated marginal means ± standard errors. For detailed results, see Tables \\@ref(tab:tab-mod1) to \\@ref(tab:tab-best-mod4) in the Supplementary Material. In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001.", warning = FALSE, message = FALSE}
ggarrange(pm1f, pm2f, pm3f, pm4f,
          common.legend = TRUE,
          legend = "bottom",
          labels = "auto")
```

# Session info (for reproducibility) {#session}

```{r results = "hold"}
library(pander)
pander(sessionInfo(), locale = FALSE)
```

# Supplementary references {#refs}

\begin{multicols}{2}
\AtNextBibliography{\footnotesize}
\printbibliography[heading=none]
\normalsize
\end{multicols}

\def\printbibliography{}
